<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>MISTJ</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content=""><meta data-n-head="ssr" name="format-detection" content="telephone=no"><link data-n-head="ssr" rel="icon" type="image/png" href="/favicon.ico.png"><link rel="preload" href="/_nuxt/js/runtime.1637221086066.js" as="script"><link rel="preload" href="/_nuxt/js/commons/app.1637221086066.js" as="script"><link rel="preload" href="/_nuxt/js/vendors/app.1637221086066.js" as="script"><link rel="preload" href="/_nuxt/js/app.1637221086066.js" as="script"><link rel="preload" href="/_nuxt/js/pages/wiki.1637221086066.js" as="script"><link rel="preload" href="/_nuxt/js/pages/wiki/content/_slug.1637221086066.js" as="script"><style data-vue-ssr-id="1a114e69:0 5fd7ed67:0 21344d92:0 387be0d0:0 fa7ff0ca:0 7d957ac6:0 613f2bb0:0">*,:after,:before{box-sizing:inherit}html{box-sizing:border-box;font-size:62.5%}body{color:#333;margin:0;background-color:#fafafa;font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;text-rendering:optimizelegibility;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased;font-size:1.6em;font-weight:300;line-height:1.8em}@media only screen and (max-width:768px){body{font-size:1.6em;line-height:1.6em}}a{font-weight:300;color:#1565c0;text-decoration:none}a:focus,a:hover{text-decoration:underline}p{margin:2rem 0}h1,h2,h3,h4,h5,h6{font-family:Lato,Helvetica,sans-serif;font-weight:700;color:#000;margin:6.4rem 0 3.2rem}h1{font-size:3.2rem;line-height:3.6rem}@media only screen and (max-width:768px){h1{font-size:3rem;line-height:3.4rem}}h2{font-size:2.8rem;line-height:3.2rem}@media only screen and (max-width:768px){h2{font-size:2.6rem;line-height:3rem}}h3{font-size:2.4rem;line-height:2.8rem}@media only screen and (max-width:768px){h3{font-size:2.2rem;line-height:2.6rem}}h4{font-size:2.2rem;line-height:2.6rem}@media only screen and (max-width:768px){h4{font-size:2rem;line-height:2.4rem}}h5{font-size:2rem;line-height:2.4rem}@media only screen and (max-width:768px){h5{font-size:1.8rem;line-height:2.2rem}}h6{font-size:1.8rem;line-height:2.2rem}@media only screen and (max-width:768px){h6{font-size:1.6rem;line-height:2rem}}b,strong{font-weight:700}.highlight>div,.highlight>pre{margin:0 0 2rem;padding:1rem;border-radius:1rem}pre{display:block;font-family:"Source Code Pro","Lucida Console",monospace;font-size:1.6rem;font-weight:400;line-height:2.6rem;overflow-x:auto;margin:0}pre code{display:inline-block;background-color:inherit;color:inherit}code{font-family:"Source Code Pro","Lucida Console",monospace;font-weight:400;background-color:#e0e0e0;color:#333}blockquote{border-left:2px solid #e0e0e0;padding-left:2rem;line-height:2.2rem;font-weight:400;font-style:italic}td,th{padding:1.6rem}table{border-collapse:collapse}table td,table th{border:2px solid #000}table tr:first-child th{border-top:0}table tr:last-child td{border-bottom:0}table tr td:first-child,table tr th:first-child{border-left:0}table tr td:last-child,table tr th:last-child{border-right:0}img{max-width:100%}figure{text-align:center}.wrapper{display:flex;flex-direction:column;min-height:100vh;width:100%}.container{margin:0 auto;max-width:90rem;width:100%;padding-left:2rem;padding-right:2rem}.fas{font-weight:700}.float-right{float:right}.float-left{float:left}.fab{font-weight:400}.fas{font-weight:900}img.emoji{height:1em;width:1em;margin:0 .05em 0 .1em;vertical-align:-.1em}#tap-to-top{display:none!important;z-index:90;position:fixed;bottom:2em;right:2em;top:auto;left:auto;color:#fafafa;padding:10px 16px;border:1px solid #fafafa;background-color:#333;transition:color .2s ease,border-color .2s ease,background .2s ease,opacity .2s ease}.toc-fixed #tap-to-top{display:inline-block!important}.flex{display:flex}.flex-y-center{display:flex;justify-content:center}.flex-align-center{display:flex;align-items:center}.content{flex:1;display:flex;margin-top:1.6rem;margin-bottom:3.2rem}.content article{width:100%;word-break:break-word;font-size:25.6px;font-size:1.6rem;line-height:1.6}.content article h1,.content article h1 *,.content article h2,.content article h2 *,.content article h3,.content article h3 *,.content article h4,.content article h4 *,.content article h5,.content article h5 *,.content article h6,.content article h6 *{word-break:break-all}.content article header{margin-top:6.4rem;margin-bottom:3.2rem}.content article header h1{font-size:4.2rem;line-height:4.6rem;margin:0}@media only screen and (max-width:768px){.content article header h1{font-size:4rem;line-height:4.4rem}}.content article footer{margin-top:4rem}.content article footer .see-also,.content article footer .see-also h3{margin:3.2rem 0}.content article div,.content article p{-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto}.content article a:hover{background:0 0}.content article img{margin:10px;padding:5px;max-width:100%;background:#fff;border:1px solid #bbb;box-shadow:1px 1px 3px #d4d4d4}.content article blockquote{display:block;position:relative;padding:15px 25px;text-align:left;line-height:inherit}.content article blockquote:before{position:absolute}.content article blockquote *{margin:0;font-size:inherit}.content article table{margin:0 0 1.2em;border:none}.content article table td,.content article table th{border:none}.content article ul{margin:0 0 1.2em;padding:0;list-style:disc}.content article ul li{font-size:inherit;list-style:disc}.content article ul li *{margin:0;text-align:left;text-align:initial}.content article ol{list-style:decimal;margin:0;padding:0}.content article ol li{list-style:decimal}.content article ol li *{margin:0;text-align:left;text-align:initial}.content article li ol,.content article li ul{margin-left:2em}.content article li ul{list-style:circle}.content article .article-center{text-align:center;display:-webkit-box;-webkit-box-align:center;-webkit-box-pack:center;-webkit-box-orient:vertical}.content article .article-center-small{display:inline-flex}.content article .article-center-small img{margin:0;padding:0;border:0;box-shadow:none}.content article .article-nobeautify{margin:0;padding:0;border:0;box-shadow:0 0 0}.content article h1,.content article h2,.content article h3,.content article h4,.content article h5,.content article h6{position:relative;margin-top:1em;margin-bottom:1pc;font-weight:700;line-height:1.4;text-align:left;color:#333}.content article h1{padding-bottom:.3em;font-size:57.6px;font-size:3.6rem;line-height:1.2}.content article h2{padding-bottom:.3em;font-size:44.8px;font-size:2.8rem;line-height:1.225}.content article h3{font-size:38.4px;font-size:2.4rem;line-height:1.43}.content article h4{font-size:32px;font-size:2rem}.content article h5,.content article h6{font-size:25.6px;font-size:1.6rem}.content article h6{color:#777}.content article ol,.content article ul{list-style-type:disc;padding:0 0 0 2em}.content article ol ol,.content article ul ol{list-style-type:lower-roman}.content article ol ol ol,.content article ol ul ol,.content article ul ol ol,.content article ul ul ol{list-style-type:lower-alpha}.content article table{width:100%;overflow:auto;word-break:normal;word-break:keep-all}.content article table tr{background-color:#fff;border-top:1px solid #ccc}.content article table th{font-weight:700}.content article table td,.content article table th{padding:6px 13px;border:1px solid #ddd}.content article blockquote{border-left:4px solid #ddd}.content article strong{font-weight:600!important;color:#000!important}.content article a:active,.content article a:focus,.content article a:hover{color:#4183c4;text-decoration:underline}.content article pre code,.content article pre code *{font-size:15px}.content article li code,.content article p code{border-radius:3px;font-size:90%;line-height:1.2;padding:.1rem .2rem;color:#d73e48;background:#fcf2f2}.content article h1,.content article h2{padding-top:1.7rem;padding-bottom:1.2rem;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAABCAYAAACsXeyTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAFUlEQVQIHWNIS0sr/v//PwMMDzY+ADqMahlW4J91AAAAAElFTkSuQmCC) 0 100% repeat-x}.content article,.content article *,.content article div,.content article p{font-weight:400;line-height:1.8}.content .co-width-2{width:16.7%}.content .co-width-10{width:83.3%}.content .co-width-12{width:100%}.content .container{max-width:90rem}.content #body-wrapper{display:flex}.content .post .post-title{margin-bottom:.75em}.content .post .post-meta .fa{text-align:center;width:1.6rem;margin-left:0;margin-right:.5rem}.content .post .post-meta .date .posted-on,.content .post .post-meta .date .reading-time{margin-left:0;margin-right:1.5rem}@media only screen and (max-width:840px){.content #toc-slider{display:none}.content .body-content{width:100%}}.content figure{margin:0;padding:0}.content figcaption p{text-align:center;font-style:italic;font-size:1.6rem;margin:0}.avatar img{width:20rem;height:auto;border-radius:50%}@media only screen and (max-width:768px){.avatar img{width:10rem}}.list ul{margin:3.2rem 0;list-style:none;padding:0}.list ul li{font-size:1.8rem}@media only screen and (max-width:768px){.list ul li{margin:1.6rem 0}}.list ul li .date{display:inline-block;flex:1;width:20rem;text-align:right;margin-right:3rem}@media only screen and (max-width:768px){.list ul li .date{display:block;text-align:left}}.list ul li .title{font-size:1.8rem;flex:2;color:#333;font-family:Lato,Helvetica,sans-serif;font-weight:700}.list ul li .title:focus,.list ul li .title:hover{color:#1565c0}@media only screen and (min-width:768.1px){.list ul:not(.pagination) li{display:flex}}.centered{display:flex;align-items:center;justify-content:center}.centered .about{text-align:center}.centered .about h1{margin-top:2rem;margin-bottom:.5rem}.centered .about h2{margin-top:1rem;margin-bottom:.5rem;font-size:2.4rem}@media only screen and (max-width:768px){.centered .about h2{font-size:2rem}}.centered .about ul{list-style:none;margin:3rem 0 1rem;padding:0}.centered .about ul li{display:inline-block;position:relative}.centered .about ul li a{color:#333;text-transform:uppercase;margin-left:1rem;margin-right:1rem;font-size:1.6rem}.centered .about ul li a:focus,.centered .about ul li a:hover{color:#1565c0}@media only screen and (max-width:768px){.centered .about ul li a{font-size:1.4rem}}.centered .about ul li a i{font-size:3.2rem}.centered .error{text-align:center}.centered .error h1{margin-top:2rem;margin-bottom:.5rem;font-size:4.6rem}@media only screen and (max-width:768px){.centered .error h1{font-size:3.2rem}}.centered .error h2{margin-top:2rem;margin-bottom:3.2rem;font-size:3.2rem}@media only screen and (max-width:768px){.centered .error h2{font-size:2.8rem}}#toc-slider{position:absolute;margin-left:15px}#TableOfContents{padding-left:12px;border-left:2px solid rgba(88,88,88,.1);overflow:hidden;max-height:calc(100vh - 60px)}#TableOfContents ul li{list-style-type:none;font-size:13px;margin-top:.4rem}#TableOfContents ul{margin-top:.1rem;margin-bottom:.1rem}#TableOfContents li,#TableOfContents ul{margin-left:5px;padding-left:0}#TableOfContents ul ul{margin-left:.6rem}#TableOfContents :hover{overflow:auto}#TableOfContents a{color:#555}#TableOfContents a.highlighted{color:#1565c0}#TableOfContents:hover{overflow:auto}.toc-fixed{position:fixed!important;top:15px;margin-top:0;overflow:hidden;z-index:1}.wiki-content-aside{left:250px;right:0}.wiki-category-aside,.wiki-content-aside{position:fixed;top:0;bottom:0;overflow:auto}.wiki-category-aside{left:0;width:250px;padding-left:10px}.wiki-category-aside a{color:inherit}.wiki-category-aside .navigation{cursor:pointer;padding-top:20px;display:flex;align-items:center;justify-content:center}.wiki-category-aside ul{list-style:none;padding-left:10px}.wiki-category-aside li{list-style:none;margin:10px 15px}.wiki-category-aside li .title{font-size:14px;font-weight:400}.pagination{margin-top:6rem;text-align:center;font-family:Lato,Helvetica,sans-serif}.pagination li{display:inline;text-align:center;font-weight:700}.pagination li span{margin:0;text-align:center;width:3.2rem}.pagination li a{font-weight:300}.pagination li a span{margin:0;text-align:center;width:3.2rem}.footer{width:100%;text-align:center;line-height:2rem;margin-bottom:1rem}.footer a{color:#1565c0}main.colorscheme-dark a{color:#42a5f5}main.colorscheme-dark h1,main.colorscheme-dark h2,main.colorscheme-dark h3,main.colorscheme-dark h4,main.colorscheme-dark h5,main.colorscheme-dark h6{color:#dadada}main.colorscheme-dark code{background-color:#424242;color:#dadada}main.colorscheme-dark pre code{background-color:inherit;color:inherit}main.colorscheme-dark blockquote{border-left:2px solid #424242}main.colorscheme-dark table td,main.colorscheme-dark table th{border:2px solid #dadada}main.colorscheme-dark blockquote{border-left:4px solid #424242}main.colorscheme-dark #TableOfContents a{color:#dadada}main.colorscheme-dark #TableOfContents a.highlighted{color:#79aae6}@media (prefers-color-scheme:dark){main.colorscheme-auto{color:#dadada;background-color:#212121}main.colorscheme-auto a{color:#42a5f5}main.colorscheme-auto h1,main.colorscheme-auto h2,main.colorscheme-auto h3,main.colorscheme-auto h4,main.colorscheme-auto h5,main.colorscheme-auto h6{color:#dadada}main.colorscheme-auto code{background-color:#424242;color:#dadada}main.colorscheme-auto pre code{background-color:inherit;color:inherit}main.colorscheme-auto blockquote{border-left:2px solid #424242}main.colorscheme-auto table td,main.colorscheme-auto table th{border:2px solid #dadada}main.colorscheme-auto blockquote{border-left:4px solid #424242}main.colorscheme-auto #TableOfContents a{color:#dadada}main.colorscheme-auto #TableOfContents a.highlighted{color:#79aae6}}main.colorscheme-dark{color:#dadada;background-color:#212121}main.colorscheme-dark .content article strong{color:#dadada!important}main.colorscheme-dark .content .list ul li .title{color:#dadada}main.colorscheme-dark .content .list ul li .title:focus,main.colorscheme-dark .content .list ul li .title:hover{color:#42a5f5}main.colorscheme-dark .content .centered .about ul li a{color:#dadada}main.colorscheme-dark .content .centered .about ul li a:focus,main.colorscheme-dark .content .centered .about ul li a:hover{color:#42a5f5}@media (prefers-color-scheme:dark){main.colorscheme-auto{color:#dadada;background-color:#212121}main.colorscheme-auto .content article strong{color:#dadada!important}main.colorscheme-auto .content .list ul li .title{color:#dadada}main.colorscheme-auto .content .list ul li .title:focus,main.colorscheme-auto .content .list ul li .title:hover{color:#42a5f5}main.colorscheme-auto .content .centered .about ul li a{color:#dadada}main.colorscheme-auto .content .centered .about ul li a:focus,main.colorscheme-auto .content .centered .about ul li a:hover{color:#42a5f5}}main.colorscheme-dark .footer a{color:#42a5f5}@media (prefers-color-scheme:dark){main.colorscheme-auto .footer a{color:#42a5f5}}.container{max-width:1100px!important;width:80%}.colorscheme-dark .navigation .navigation-list .navigation-item .dropdown-content{background-color:#212121}.colorscheme-dark pre{color:#333}.wiki{width:100%!important;max-width:100%!important}.wiki #body-wrapper{width:100%}.wiki .post{max-width:100%!important}.wiki .wiki-cate-aside{font-weight:400;display:inline;float:left;visibility:visible;font-size:13px;width:240px;padding:0 20px 20px}.wiki .wiki-cate-aside ul{margin:0}.wiki .wiki-cate-aside a{font-size:13px;color:#555;font-weight:400}.wiki .wiki-cate-aside ol,.wiki .wiki-cate-aside ul{list-style:none;padding-left:20px}#articleWikiWrap{margin-left:240px}@media only screen and (max-width:900px){#articleWikiWrap{margin-left:0}#articleWikiAside{display:none}}code[class*=language-],pre[class*=language-]{color:#e3eaf2;background:0 0;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{background:#3c526d}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#3c526d}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#111b27}:not(pre)>code[class*=language-]{padding:.1em .3em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8da1b9}.token.punctuation{color:#e3eaf2}.token.delimiter.important,.token.selector .parent,.token.tag,.token.tag .token.punctuation{color:#6cc}.token.attr-name,.token.boolean,.token.boolean.important,.token.constant,.token.number,.token.selector .token.attribute{color:#e6d37a}.token.class-name,.token.key,.token.parameter,.token.property,.token.property-access,.token.variable{color:#6cb8e6}.token.attr-value,.token.color,.token.inserted,.token.selector .token.value,.token.string,.token.string .token.url-link{color:#91d076}.token.builtin,.token.keyword-array,.token.package,.token.regex{color:#f4adf4}.token.function,.token.selector .token.class,.token.selector .token.id{color:#c699e3}.token.atrule .token.rule,.token.combinator,.token.keyword,.token.operator,.token.pseudo-class,.token.pseudo-element,.token.selector,.token.unit{color:#e9ae7e}.token.deleted,.token.important{color:#cd6660}.token.keyword-this,.token.this{color:#6cb8e6}.token.bold,.token.important,.token.keyword-this,.token.this{font-weight:700}.token.delimiter.important{font-weight:inherit}.token.italic{font-style:italic}.token.entity{cursor:help}.language-markdown .token.title,.language-markdown .token.title .token.punctuation{color:#6cb8e6;font-weight:700}.language-markdown .token.blockquote.punctuation{color:#f4adf4}.language-markdown .token.code{color:#6cc}.language-markdown .token.hr.punctuation{color:#6cb8e6}.language-markdown .token.url .token.content{color:#91d076}.language-markdown .token.url-link{color:#e6d37a}.language-markdown .token.list.punctuation{color:#f4adf4}.language-json .token.operator,.language-markdown .token.table-header{color:#e3eaf2}.language-scss .token.variable{color:#6cc}.token.cr:before,.token.lf:before,.token.space:before,.token.tab:not(:empty):before{color:#8da1b9}div.code-toolbar>.toolbar a,div.code-toolbar>.toolbar button{color:#111b27;background:#6cb8e6}div.code-toolbar>.toolbar a:focus,div.code-toolbar>.toolbar a:hover,div.code-toolbar>.toolbar button:focus,div.code-toolbar>.toolbar button:hover{color:#111b27;background:rgba(108,184,230,.8549);text-decoration:none}div.code-toolbar>.toolbar span,div.code-toolbar>.toolbar span:focus,div.code-toolbar>.toolbar span:hover{color:#111b27;background:#8da1b9}.line-highlight{background:rgba(60,82,109,.37255);background:linear-gradient(90deg,rgba(60,82,109,.37255) 70%,rgba(60,82,109,.33333))}.line-highlight:before,.line-highlight[data-end]:after{background-color:#8da1b9;color:#111b27;box-shadow:0 1px #3c526d}pre[id].linkable-line-numbers span.line-numbers-rows>span:hover:before{background-color:rgba(141,161,185,.09412)}.line-numbers .line-numbers-rows{border-right:1px solid #0b121b;background:rgba(11,18,27,.47843)}.line-numbers-rows>span:before{color:rgba(141,161,185,.8549)}.rainbow-braces .token.punctuation.brace-level-1,.rainbow-braces .token.punctuation.brace-level-5,.rainbow-braces .token.punctuation.brace-level-9{color:#e6d37a}.rainbow-braces .token.punctuation.brace-level-10,.rainbow-braces .token.punctuation.brace-level-2,.rainbow-braces .token.punctuation.brace-level-6{color:#f4adf4}.rainbow-braces .token.punctuation.brace-level-11,.rainbow-braces .token.punctuation.brace-level-3,.rainbow-braces .token.punctuation.brace-level-7{color:#6cb8e6}.rainbow-braces .token.punctuation.brace-level-12,.rainbow-braces .token.punctuation.brace-level-4,.rainbow-braces .token.punctuation.brace-level-8{color:#c699e3}pre.diff-highlight>code .token.deleted:not(.prefix),pre>code.diff-highlight .token.deleted:not(.prefix){background-color:rgba(205,102,96,.12157)}pre.diff-highlight>code .token.inserted:not(.prefix),pre>code.diff-highlight .token.inserted:not(.prefix){background-color:rgba(145,208,118,.12157)}.command-line-prompt{border-right:1px solid #0b121b}.command-line-prompt>span:before{color:rgba(141,161,185,.8549)}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#000;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}.wiki-content-aside[data-v-468ad0ce]{margin:0;padding-right:0;max-width:100%!important;padding-bottom:20px}a[data-v-358b86fc]{font-weight:400;word-break:break-all;color:inherit}.side-highlighted[data-v-358b86fc]{color:#1565c0}main.colorscheme-dark a[data-v-358b86fc]{color:inherit}main.colorscheme-dark .side-highlighted[data-v-358b86fc]{color:#1565c0}li[data-v-358b86fc]{margin:5px;line-height:1.5}li ul[data-v-358b86fc]{padding-left:0}</style><link rel="preload" href="/_nuxt/static/1637221111/wiki/content/%E9%97%AE%E4%B8%8E%E7%AD%94-%E4%B8%BA%E4%BB%80%E4%B9%88ui%E6%93%8D%E4%BD%9C%E8%A6%81%E5%9C%A8%E4%B8%BB%E7%BA%BF%E7%A8%8B/state.js" as="script"><link rel="preload" href="/_nuxt/static/1637221111/wiki/content/%E9%97%AE%E4%B8%8E%E7%AD%94-%E4%B8%BA%E4%BB%80%E4%B9%88ui%E6%93%8D%E4%BD%9C%E8%A6%81%E5%9C%A8%E4%B8%BB%E7%BA%BF%E7%A8%8B/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1637221111/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><main class="wrapper colorscheme-auto"><div class="content" data-v-468ad0ce><div class="wiki-category-aside" data-v-468ad0ce><div class="navigation" data-v-468ad0ce><div data-v-468ad0ce><fa icon="fa,arrow-left" class="fa" data-v-468ad0ce></fa> <span style="margin-left:8px" data-v-468ad0ce>Go back</span></div> <div style="padding:0 20px" data-v-468ad0ce>
        Home
      </div></div> <ul data-v-358b86fc data-v-468ad0ce><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      iOS
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/iOS-Swift-ObjectMapper%20%E6%8C%87%E5%8D%97" class="title" data-v-358b86fc>
          Swift-ObjectMapper 指南
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/iOS-URL%20Schemes%20&&%20Universal%20Links%20%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8" class="title" data-v-358b86fc>
          URL Schemes && Universal Links 简单使用
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/iOS-YYModel" class="title" data-v-358b86fc>
          YYModel几种使用场景
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/iOS-ios-useful-link" class="title" data-v-358b86fc>
          '实用链接
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/iOS-mrpeak%E6%9D%82%E8%B4%A7%E9%93%BA-iOS%E5%BA%94%E7%94%A8%E5%B1%82%E6%9E%B6%E6%9E%84%E4%B9%8BCDD" class="title" data-v-358b86fc>
          (转)mrpeak杂货铺-iOS应用层架构之CDD
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/iOS-%E6%A3%80%E6%B5%8B%E7%A6%BB%E5%B1%8F%E6%B8%B2%E6%9F%93%E4%B8%8E%E7%BB%98%E5%88%B6%E9%AB%98%E6%80%A7%E8%83%BD%E5%9C%86%E8%A7%92" class="title" data-v-358b86fc>
          (待)检测离屏渲染与绘制高性能圆角
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/iOS-%E6%B7%B1%E5%BA%A6%E9%87%8D%E6%9E%84UIViewController" class="title" data-v-358b86fc>
          (转)mrpeak杂货铺-深度重构UIViewController
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/iOS-%E6%B7%BB%E5%8A%A0%E5%AD%97%E4%BD%93%E5%BA%93" class="title" data-v-358b86fc>
          使用第三方字体
        </a></li> <li class="directory" data-v-358b86fc><ul data-v-358b86fc data-v-358b86fc><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      3part
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/3part-umeng-install" class="title" data-v-358b86fc>
          快速集成友盟分享
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/3part-%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98" class="title" data-v-358b86fc>
          快速集成微信/支付宝/银联
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/3part-%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE" class="title" data-v-358b86fc>
          集成百度地图、百度导航
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/3part-%E9%98%BF%E9%87%8C%E4%BA%91%E8%A7%86%E9%A2%91%E7%82%B9%E6%92%AD%E9%9B%86%E6%88%90" class="title" data-v-358b86fc>
          阿里云视频点播VOD
        </a></li> <li class="directory" data-v-358b86fc><!----></li></ul></li><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      Autolayout
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/Autolayout-baseline" class="title" data-v-358b86fc>
          label底部对齐、顶部对齐
        </a></li> <li class="directory" data-v-358b86fc><!----></li></ul></li><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      Error
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/Error-2017-07-31" class="title" data-v-358b86fc>
          Undefined symbols for architecture ..
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/Error-Shell-Script-Invocation-Error" class="title" data-v-358b86fc>
          'Shell Script Invocation Error'
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/Error-gesture" class="title" data-v-358b86fc>
          tableViewCell的点击和tapGestureRecognizer冲突的处理
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/Error-%E5%B4%A9%E6%BA%83%E5%88%86%E6%9E%90" class="title" data-v-358b86fc>
          崩溃分析(转载)
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/Error-%E7%AB%96%E5%B1%8F%E4%B8%8B%E8%A7%86%E9%A2%91%E5%85%A8%E5%B1%8F%E6%92%AD%E6%94%BE" class="title" data-v-358b86fc>
          (转)竖屏下视频全屏播放
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/Error-%E8%AF%81%E4%B9%A6%E8%BF%87%E6%9C%9F%E6%88%96%E8%80%85%E7%A7%BB%E9%99%A4%E5%AF%B9app%E7%9A%84%E5%BD%B1%E5%93%8D" class="title" data-v-358b86fc>
          证书过期或者移除对app的影响
        </a></li> <li class="directory" data-v-358b86fc><!----></li></ul></li><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      Objective-C
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/Objective-C-KVO%20-%20Observe%20property%20of%20an%20object%20contained%20in%20a%20NSArray" class="title" data-v-358b86fc>
          KVO - Observe property of an object contained in a NSArray
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/Objective-C-NSArrayFilter" class="title" data-v-358b86fc>
          NSArray: filteredArrayUsingPredicate
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/Objective-C-NSRecursiveLock" class="title" data-v-358b86fc>
          NSRecursiveLock
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/Objective-C-NSStringCompareOptions" class="title" data-v-358b86fc>
          NSStringCompareOptions
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/Objective-C-containsObject-or-removeObject" class="title" data-v-358b86fc>
          containsObject or removeObject
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/Objective-C-get-lunarholidays" class="title" data-v-358b86fc>
          节气、节假日计算
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/Objective-C-use-dispatch_queue_t-with-strong" class="title" data-v-358b86fc>
          dispatch_queue_t 用strong来修饰
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/Objective-C-%E5%86%9C%E5%8E%86" class="title" data-v-358b86fc>
          农历
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/Objective-C-%E5%B8%B8%E7%94%A8%E7%9A%84%E5%AE%8F" class="title" data-v-358b86fc>
          常用的宏
        </a></li> <li class="directory" data-v-358b86fc><!----></li></ul></li><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      StatusBar
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/StatusBar-how-to-detect-touches-in-status-bar" class="title" data-v-358b86fc>
          获取StatusBar的点击事件
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/StatusBar-ios-status-bar-style" class="title" data-v-358b86fc>
          修改StatusBarStyle以及statusBar的背景颜色
        </a></li> <li class="directory" data-v-358b86fc><!----></li></ul></li><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      UIKit
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/UIKit-UIAlertController%E4%BF%AE%E6%94%B9%E6%96%87%E5%AD%97%E5%AF%B9%E9%BD%90%E6%96%B9%E5%BC%8F" class="title" data-v-358b86fc>
          UIAlertController修改文字对齐方式
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/UIKit-UIDynamic%20Animator" class="title" data-v-358b86fc>
          UIDynamic Animator
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/UIKit-UISplit%E2%80%8BView%E2%80%8BController%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0" class="title" data-v-358b86fc>
          UISplit​View​Controller 学习笔记
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/UIKit-searchBar-style" class="title" data-v-358b86fc>
          如何修改searchBar的样式
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/UIKit-uioffset" class="title" data-v-358b86fc>
          UIOffset
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/UIKit-%E5%B1%8F%E5%B9%95%E6%97%8B%E8%BD%AC.md" class="title" data-v-358b86fc>
          屏幕旋转
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/UIKit-%E7%A6%BB%E5%B1%8F%E6%B8%B2%E6%9F%93" class="title" data-v-358b86fc>
          (转)关于iOS离屏渲染的深入研究
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/UIKit-%E7%BB%99WebView%E6%B7%BB%E5%8A%A0%E4%B8%AA%E7%B2%97%E7%B3%99%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB" class="title" data-v-358b86fc>
          给UIWebView添加个粗糙的加载动画
        </a></li> <li class="directory" data-v-358b86fc><!----></li></ul></li><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      UITextFeild
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/UITextFeild-2018-01-16" class="title" data-v-358b86fc>
          修改光标颜色和clear button的颜色
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/UITextFeild-uitextfeild-select-all" class="title" data-v-358b86fc>
          默认选中文本
        </a></li> <li class="directory" data-v-358b86fc><!----></li></ul></li><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      keyboard
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/keyboard-disable-3rd-keyboard" class="title" data-v-358b86fc>
          禁用第三方键盘
        </a></li> <li class="directory" data-v-358b86fc><!----></li></ul></li><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      loc
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/loc-2018-01-22" class="title" data-v-358b86fc>
          CLPlacemark中文
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/loc-sim-locaiton-ios" class="title" data-v-358b86fc>
          真机或模拟器修改定位位置
        </a></li> <li class="directory" data-v-358b86fc><!----></li></ul></li><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      tableView
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/tableView-cell-seprateLine" class="title" data-v-358b86fc>
          cell分割线的颜色
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/tableView-compare-NSIndexPath" class="title" data-v-358b86fc>
          compare NSIndexPath
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/tableView-tabeleView%20%E8%8E%B7%E5%8F%96%E6%9F%90%E4%B8%AAcell%E7%9A%84%E9%AB%98%E5%BA%A6" class="title" data-v-358b86fc>
          tabeleView 获取某个cell的高度
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/tableView-taleview-headerfooterView-xib" class="title" data-v-358b86fc>
          xib UITableViewHeaderFooterView
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/tableView-%E7%BB%93%E5%90%88layoutMargins%E5%81%9AtableViewCell%E7%9A%84%E9%80%82%E9%85%8D" class="title" data-v-358b86fc>
          结合layoutMargins做cell的适配
        </a></li> <li class="directory" data-v-358b86fc><!----></li></ul></li><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      xib
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/xib-%E5%A6%82%E4%BD%95%E6%9B%BF%E6%8D%A2%E5%B7%B2%E6%9C%89%E7%9A%84%E6%8E%A7%E4%BB%B6" class="title" data-v-358b86fc>
          如何替换已有的控件
        </a></li> <li class="directory" data-v-358b86fc><!----></li></ul></li><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      代码片段
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5-%E5%88%86%E5%89%B2%E5%B0%8F%E8%AF%B4%E7%AB%A0%E8%8A%82" class="title" data-v-358b86fc>
          分割小说章节
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5-%E6%88%AA%E5%9B%BE%20%E6%88%AA%E9%95%BF%E5%9B%BE%20%E9%AB%98%E6%B8%85%E5%9B%BE" class="title" data-v-358b86fc>
          截图 截长图 高清图
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5-%E8%AF%BB%E5%8F%96%E6%9C%AA%E7%9F%A5%E7%B1%BB%E5%9E%8B%E7%9A%84txt%E6%96%87%E4%BB%B6" class="title" data-v-358b86fc>
          读取未知类型的txt文件 
        </a></li> <li class="directory" data-v-358b86fc><!----></li></ul></li><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      包管理工具
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-spm-introduce" class="title" data-v-358b86fc>
          Swift Package Manager介绍
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7-spm-resource-handle" class="title" data-v-358b86fc>
          SWift Package Manager资源文件管理
        </a></li> <li class="directory" data-v-358b86fc><!----></li></ul></li><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      日历
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/%E6%97%A5%E5%8E%86-FSCalendar" class="title" data-v-358b86fc>
          FSCalendar
        </a></li> <li class="directory" data-v-358b86fc><!----></li></ul></li><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      适配
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/%E9%80%82%E9%85%8D-NFC%E5%88%9D%E8%AF%95" class="title" data-v-358b86fc>
          NFC初试
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/%E9%80%82%E9%85%8D-iOS11%20Xcode9%E6%96%B0%E5%8A%9F%E8%83%BD%E6%96%B0%E7%89%B9%E6%80%A7" class="title" data-v-358b86fc>
          iOS11 Xcode9新功能新特性
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/%E9%80%82%E9%85%8D-iOS11%20tableView%E9%80%82%E9%85%8D%E4%B8%8D%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97" class="title" data-v-358b86fc>
          iOS11 tableView适配不完全指南
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/%E9%80%82%E9%85%8D-iOS11%E5%88%98%E6%B5%B7%E5%B1%8FEdgeProtect%E7%9B%B8%E5%85%B3" class="title" data-v-358b86fc>
          iOS11刘海屏EdgeProtect相关
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/%E9%80%82%E9%85%8D-iOS11%E9%80%82%E9%85%8D%E5%8F%82%E8%80%83" class="title" data-v-358b86fc>
          iOS11 适配参考
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/%E9%80%82%E9%85%8D-iOS14hidesBottomBarWhenPushed%E5%85%BC%E5%AE%B9%E9%97%AE%E9%A2%98" class="title" data-v-358b86fc>
          iOS14 hidesBottomBarWhenPushed兼容问题
        </a></li><li class="file" data-v-358b86fc><a href="/wiki/content/%E9%80%82%E9%85%8D-touch-id" class="title" data-v-358b86fc>
          touch Id
        </a></li> <li class="directory" data-v-358b86fc><!----></li></ul></li><li class="directory" data-v-358b86fc><a href="#" data-role="directory" data-v-358b86fc><fa icon="fa,angle-down" class="fa" data-v-358b86fc></fa>
      问与答
    </a> <ul style="display:block" data-v-358b86fc><li class="file" data-v-358b86fc><a href="/wiki/content/%E9%97%AE%E4%B8%8E%E7%AD%94-%E4%B8%BA%E4%BB%80%E4%B9%88ui%E6%93%8D%E4%BD%9C%E8%A6%81%E5%9C%A8%E4%B8%BB%E7%BA%BF%E7%A8%8B" aria-current="page" class="title nuxt-link-exact-active nuxt-link-active side-highlighted" data-v-358b86fc>
          为什么ui操作要在主线程
        </a></li> <li class="directory" data-v-358b86fc><!----></li></ul></li></ul></li></ul></li></ul></div> <div class="wiki-content-aside" data-v-468ad0ce><section class="container post" style="width:100%" data-v-468ad0ce><article data-v-468ad0ce><header data-v-17b8de7f data-v-468ad0ce><div class="post-title" data-v-17b8de7f><h1 class="title" data-v-17b8de7f>为什么ui操作要在主线程</h1></div> <div class="post-meta" data-v-17b8de7f><div class="date" data-v-17b8de7f><span class="posted-on" data-v-17b8de7f><fa icon="fa,calendar-alt" class="fa" data-v-17b8de7f></fa> <time datetime="2020-06-25 11:32:22" data-v-17b8de7f>
                November 16, 2020
              </time></span></div> <div class="categories" data-v-17b8de7f><fa icon="fa,folder" class="fa" data-v-17b8de7f></fa> <a href="/wiki/#iOS" data-v-17b8de7f> iOS</a></div> <!----></div></header> <aside id="body-wrapper" data-v-468ad0ce><div id="contents" class="body-content co-width-10" data-v-468ad0ce><div class="nuxt-content" data-v-468ad0ce data-v-468ad0ce><blockquote data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce>本文由 <a href="http://ksria.com/simpread/" rel="nofollow noopener noreferrer" target="_blank" data-v-468ad0ce data-v-468ad0ce>简悦 SimpRead</a> 转码， 原文地址 <a href="https://juejin.im/post/6844903763011076110" rel="nofollow noopener noreferrer" target="_blank" data-v-468ad0ce data-v-468ad0ce>juejin.im</a></p>
</blockquote>
<p data-v-468ad0ce data-v-468ad0ce>但仔细去思考，究竟为什么一定要在主线程操作 UI 呢？如果在后台线程对 UI 进行操作会发生什么？在后台线程对 UI 进行操作不是可以更好的避免卡顿吗？这篇文章就是基于这样一些疑问而产生的。</p>
<blockquote data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce><strong data-v-468ad0ce data-v-468ad0ce>太长不看版：</strong></p>
<p data-v-468ad0ce data-v-468ad0ce>UIKit 并不是一个 <strong data-v-468ad0ce data-v-468ad0ce>线程安全</strong> 的类，UI 操作涉及到渲染访问各种 View 对象的属性，如果异步操作下会存在读写问题，而为其加锁则会耗费大量资源并拖慢运行速度。另一方面因为整个程序的起点<code data-v-468ad0ce data-v-468ad0ce>UIApplication</code>是在主线程进行初始化，所有的用户事件都是在主线程上进行传递（如点击、拖动），所以 view 只能在主线程上才能对事件进行响应。而在渲染方面由于图像的渲染需要以 60 帧的刷新率在屏幕上 <strong data-v-468ad0ce data-v-468ad0ce>同时</strong> 更新，在非主线程异步化的情况下无法确定这个处理过程能够实现同步更新。</p>
</blockquote>
<hr data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce><img alt="" src="https://user-gold-cdn.xitu.io/2019/1/17/1685baecc3293040?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-v-468ad0ce data-v-468ad0ce></p>
<h2 id="从-uikit-线程不安全说起" data-v-468ad0ce data-v-468ad0ce><a href="#%E4%BB%8E-uikit-%E7%BA%BF%E7%A8%8B%E4%B8%8D%E5%AE%89%E5%85%A8%E8%AF%B4%E8%B5%B7" aria-hidden="true" tabindex="-1" data-v-468ad0ce data-v-468ad0ce><span class="icon icon-link" data-v-468ad0ce data-v-468ad0ce></span></a>从 UIKit 线程不安全说起</h2>
<p data-v-468ad0ce data-v-468ad0ce>在 UIKit 中，很多类中大部分的属性都被修饰为<code data-v-468ad0ce data-v-468ad0ce>nonatomic</code>，这意味着它们不能在多线程的环境下工作，而对于 UIKit 这样一个庞大的框架，将其所有属性都设计为线程安全是不现实的，这可不仅仅是简单的将<code data-v-468ad0ce data-v-468ad0ce>nonatomic</code>改成<code data-v-468ad0ce data-v-468ad0ce>atomic</code>或者是加锁解锁的操作，还涉及到很多的方面：</p>
<ul data-v-468ad0ce data-v-468ad0ce>
<li data-v-468ad0ce data-v-468ad0ce>假设能够异步设置 view 的属性，那我们究竟是希望这些改动能够同时生效，还是按照各自 runloop 的进度去改变这个 view 的属性呢？</li>
<li data-v-468ad0ce data-v-468ad0ce>假设<code data-v-468ad0ce data-v-468ad0ce>UITableView</code>在其他线程去移除了一个 cell，而在另一个线程却对这个 cell 所在的 index 进行一些操作，这时候可能就会引发 crash。</li>
<li data-v-468ad0ce data-v-468ad0ce>如果在后台线程移除了一个 view，这个时候 runloop 周期还没有完结，用户在主线程点击了这个 “将要” 消失的 view，那么究竟该不该响应事件？在哪条线程进行响应？</li>
</ul>
<p data-v-468ad0ce data-v-468ad0ce>仔细思考，似乎能够多线程处理 UI 并没有给我们开发带来更多的便利，假如你代入了这些情景进行思考，你很容易得出一个结论： <strong data-v-468ad0ce data-v-468ad0ce>“我在一个串行队列对这些事件进行处理就可以了。”</strong> 苹果也是这样想的，所以 UIKit 的所有操作都要放到主线程串行执行。</p>
<p data-v-468ad0ce data-v-468ad0ce>在 <a href="https://www.objc.io/issues/2-concurrency/thread-safe-class-design/" rel="nofollow noopener noreferrer" target="_blank" data-v-468ad0ce data-v-468ad0ce>Thread-Safe Class Design</a> 一文提到：</p>
<blockquote data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce>It’s a conscious design decision from Apple’s side to not have UIKit be thread-safe. Making it thread-safe <strong data-v-468ad0ce data-v-468ad0ce>wouldn’t buy you much in terms of performance;</strong> it would in fact make many things slower. And the fact that UIKit is tied to the main thread makes it very easy to write concurrent programs and use UIKit. All you have to do is make sure that calls into UIKit are always made on the main thread.</p>
</blockquote>
<p data-v-468ad0ce data-v-468ad0ce>大意为把 UIKit 设计成线程安全并不会带来太多的便利，也不会提升太多的性能表现，甚至会因为加锁解锁而耗费大量的时间。事实上并发编程也没有因为 UIKit 是线程不安全而变得困难，我们所需要做的只是要确保 UI 操作在主线程进行就可以了。</p>
<hr data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce><img alt="" src="https://user-gold-cdn.xitu.io/2019/1/17/1685bad1b33958cf?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-v-468ad0ce data-v-468ad0ce></p>
<blockquote data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce>好吧，那假设我们用黑魔法祝福了 UIKit，这个 UIKit 能够完美的解决我们上面提到的问题，并能够按照开发者的想法随意展现不同的形态。那这个时候我们可以在后台线程操作 UI 了嘛？</p>
</blockquote>
<p data-v-468ad0ce data-v-468ad0ce><strong data-v-468ad0ce data-v-468ad0ce>很可惜，还是不行。</strong></p>
<h2 id="runloop-与绘图循环" data-v-468ad0ce data-v-468ad0ce><a href="#runloop-%E4%B8%8E%E7%BB%98%E5%9B%BE%E5%BE%AA%E7%8E%AF" aria-hidden="true" tabindex="-1" data-v-468ad0ce data-v-468ad0ce><span class="icon icon-link" data-v-468ad0ce data-v-468ad0ce></span></a>Runloop 与绘图循环</h2>
<p data-v-468ad0ce data-v-468ad0ce>道理我们都懂，那这个究竟跟我们不能在后台线程操作 UI 有什么关系呢？</p>
<p data-v-468ad0ce data-v-468ad0ce><code data-v-468ad0ce data-v-468ad0ce>UIApplication</code>在主线程所初始化的 Runloop 我们称为<code data-v-468ad0ce data-v-468ad0ce>Main Runloop</code>，它负责处理 app 存活期间的大部分事件，如用户交互等，它一直处于不断处理事件和休眠的循环之中，以确保能尽快的将用户事件传递给 GPU 进行渲染，使用户行为能够得到响应，画面之所以能够得到不断刷新也是因为<code data-v-468ad0ce data-v-468ad0ce>Main Runloop</code>在驱动着。</p>
<p data-v-468ad0ce data-v-468ad0ce>而每一个 view 的变化的修改并不是立刻变化，相反的会在当前 run loop 的结束的时候统一进行重绘，这样设计的目的是为了能够在一个 runloop 里面处理好所有需要变化的 view，包括 resize、hide、reposition 等等，所有 view 的改变都能在同一时间生效，这样能够更高效的处理绘制，这个机制被称为<strong data-v-468ad0ce data-v-468ad0ce>绘图循环（View Drawing Cycle)</strong>。</p>
<p data-v-468ad0ce data-v-468ad0ce>假设这个时候我们应用了我们的魔法 UIKit，并愉快的在一条后台线程操作 UI，但当我们需要对设备进行旋转并重新布局的时候，问题来了，因为各个线程之间不同步，这时候各个 view 修改的请求时机是零碎的，所以所有的旋转变化并不能在<code data-v-468ad0ce data-v-468ad0ce>Main Runloop</code>的一个 runloop 里面处理完，这就导致设备旋转之后还有一些 view 迟迟没有旋转。</p>
<p data-v-468ad0ce data-v-468ad0ce>另一方面，因为我们的魔法 UIKit 并不是在主线程，所以<code data-v-468ad0ce data-v-468ad0ce>Main Runloop</code>中的事件需要跨线程进行传输，这样会导致显示与用户事件并不同步。试想一下我们用我们的魔法 UIKit 写了一个游戏，用户如果在图片还没有加载出来的时候按下了按钮，他们就能胜利，于是我们写出了这样的代码：</p>
<p data-v-468ad0ce data-v-468ad0ce><strong data-v-468ad0ce data-v-468ad0ce>game.m</strong></p>
<div class="nuxt-content-highlight" data-v-468ad0ce data-v-468ad0ce><pre class="language-text line-numbers" data-v-468ad0ce data-v-468ad0ce><code data-v-468ad0ce data-v-468ad0ce>- (void)didClickButton:(UIButton *)button
{
    if (self.imageView.image != nil) {
        // User lose!
    } else {
        // User Win!
    }
}

- (void)loadImageInBackgroundThread
{
    dispatch_async(dispatch_queue_create("BackgroundQueue", NULL), ^{
        self.imageView.image = [self downloadedImage];
    };
}

复制代码
</code></pre></div>
<p data-v-468ad0ce data-v-468ad0ce>因为我们完美的魔法 UIKit，在后台执行<code data-v-468ad0ce data-v-468ad0ce>imageView.image = xxx</code>并不会产生任何问题。游戏上线，在你还为后台处理 UI 而沾沾自喜的时候，用户投诉了他们明明没有看到图片显示，点击的时候还是告诉他们输了，于是你的产品就这样扑街了。</p>
<p data-v-468ad0ce data-v-468ad0ce>这是因为点击等事件是由系统传递给<code data-v-468ad0ce data-v-468ad0ce>UIApplication</code>中，并在<code data-v-468ad0ce data-v-468ad0ce>Main Runloop</code>中进行处理与响应，但是由于 UI 在后台线程中进行处理，所以他跟事件响应并不同步。即使在 UI 所在的后台线程也自己维护了一个 Runloop，在 Runloop 结束时候进行渲染，但可能用户已经进行了点击操作并开始辱骂你的游戏了。</p>
<hr data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce><img alt="" src="https://user-gold-cdn.xitu.io/2019/1/17/1685badaa9010a63?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-v-468ad0ce data-v-468ad0ce></p>
<blockquote data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce>好吧，那假设我天赋异禀，把整套 UIApplication 的机制全都重写了，也用黑魔法祝福了我的新 UIApplication，这个时候它能完美的解决线程同步的问题，这个时候我可以在后台操作 UI 了吗？</p>
</blockquote>
<p data-v-468ad0ce data-v-468ad0ce><strong data-v-468ad0ce data-v-468ad0ce>……</strong></p>
<p data-v-468ad0ce data-v-468ad0ce><strong data-v-468ad0ce data-v-468ad0ce>……</strong></p>
<p data-v-468ad0ce data-v-468ad0ce><strong data-v-468ad0ce data-v-468ad0ce>很可惜，还是不能。</strong></p>
<h2 id="理解-ios-的渲染流程" data-v-468ad0ce data-v-468ad0ce><a href="#%E7%90%86%E8%A7%A3-ios-%E7%9A%84%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B" aria-hidden="true" tabindex="-1" data-v-468ad0ce data-v-468ad0ce><span class="icon icon-link" data-v-468ad0ce data-v-468ad0ce></span></a>理解 iOS 的渲染流程</h2>
<p data-v-468ad0ce data-v-468ad0ce>要回答这个问题，我们要先从最底层的渲染说起。</p>
<h3 id="渲染系统框架" data-v-468ad0ce data-v-468ad0ce><a href="#%E6%B8%B2%E6%9F%93%E7%B3%BB%E7%BB%9F%E6%A1%86%E6%9E%B6" aria-hidden="true" tabindex="-1" data-v-468ad0ce data-v-468ad0ce><span class="icon icon-link" data-v-468ad0ce data-v-468ad0ce></span></a>渲染系统框架</h3>
<p data-v-468ad0ce data-v-468ad0ce><img alt="" src="https://user-gold-cdn.xitu.io/2019/1/17/1685badd6f86fdb4?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-v-468ad0ce data-v-468ad0ce></p>
<ul data-v-468ad0ce data-v-468ad0ce>
<li data-v-468ad0ce data-v-468ad0ce>UIKit: 包含各种控件，负责对用户操作事件的响应，本身并不提供渲染的能力</li>
<li data-v-468ad0ce data-v-468ad0ce>Core Animation: 负责所有视图的绘制、显示与动画效果</li>
<li data-v-468ad0ce data-v-468ad0ce>OpenGL ES: 提供 2D 与 3D 渲染服务</li>
<li data-v-468ad0ce data-v-468ad0ce>Core Graphics: 提供 2D 渲染服务</li>
<li data-v-468ad0ce data-v-468ad0ce>Graphics Hardware: 指 GPU</li>
</ul>
<p data-v-468ad0ce data-v-468ad0ce>所以在 iOS 中，所有视图的现实与动画本质上是由 <strong data-v-468ad0ce data-v-468ad0ce>Core Animation</strong> 负责，而不是 UIKit。</p>
<h3 id="core-animation-pipeline-流水线" data-v-468ad0ce data-v-468ad0ce><a href="#core-animation-pipeline-%E6%B5%81%E6%B0%B4%E7%BA%BF" aria-hidden="true" tabindex="-1" data-v-468ad0ce data-v-468ad0ce><span class="icon icon-link" data-v-468ad0ce data-v-468ad0ce></span></a>Core Animation Pipeline 流水线</h3>
<p data-v-468ad0ce data-v-468ad0ce><img alt="" src="https://user-gold-cdn.xitu.io/2019/1/17/1685badf08f1dda1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-v-468ad0ce data-v-468ad0ce></p>
<p data-v-468ad0ce data-v-468ad0ce>Core Animation 的绘制是通过 Core Animation Pipeline 实现，它以流水线的形式进行渲染，具体分为四个步骤：</p>
<ul data-v-468ad0ce data-v-468ad0ce>
<li data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce>Commit Transaction:</p>
<p data-v-468ad0ce data-v-468ad0ce>可以细分为</p>
<ul data-v-468ad0ce data-v-468ad0ce>
<li data-v-468ad0ce data-v-468ad0ce>Layout: 构建视图布局如<code data-v-468ad0ce data-v-468ad0ce>addSubview</code>等操作</li>
<li data-v-468ad0ce data-v-468ad0ce>Display: 重载<code data-v-468ad0ce data-v-468ad0ce>drawRect:</code>进行时图绘制，该步骤使用 CPU 与内存</li>
<li data-v-468ad0ce data-v-468ad0ce>Prepare: 主要处理图像的解码与格式转换等操作</li>
<li data-v-468ad0ce data-v-468ad0ce>Commit: 将 Layer 递归打包并发送到 Render Server</li>
</ul>
</li>
<li data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce>Render Server:</p>
<p data-v-468ad0ce data-v-468ad0ce>负责渲染工作，会解析上一步 Commit Transaction 中提交的信息并反序列化成渲染树（render tree)，随后根据 layer 的各种属性生成绘制指令，并在下一次 VSync 信号到来时调用 OpenGL 进行渲染。</p>
</li>
<li data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce>GPU:</p>
<p data-v-468ad0ce data-v-468ad0ce>GPU 会等待显示器的 VSync 信号发出后才进行 OpenGL 渲染管线，将 3D 几何数据转化成 2D 的像素图像和光栅处理，随后进行新的一帧的渲染，并将其输出到缓冲区。</p>
</li>
<li data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce>Dispaly:</p>
<p data-v-468ad0ce data-v-468ad0ce>从缓冲区中取出画面，并输出到屏幕上。</p>
</li>
</ul>
<p data-v-468ad0ce data-v-468ad0ce><strong data-v-468ad0ce data-v-468ad0ce>知识补充：iOS 的 VSync 与双缓冲机制</strong></p>
<p data-v-468ad0ce data-v-468ad0ce><strong data-v-468ad0ce data-v-468ad0ce>VSync:</strong></p>
<blockquote data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce>VSync（vertical sync）是指<strong data-v-468ad0ce data-v-468ad0ce>垂直同步</strong>，在玩游戏的时候在设置的时候应该会看见过这个选项，这个机制能够让显卡和显示器保持在一个相同的刷新率从而避免画面撕裂。在 iOS 中，屏幕具有 60Hz 的刷新率，这意味着它每秒需要显示 60 张不同的图片（帧），但 GPU 并没有一个确定的刷新率，在某些时候 GPU 可能被要求更强力的数据输出来确保渲染能力，这时候他们可能比屏幕刷新率（60Hz）更快，就会导致屏幕不能完整的渲染所有 GPU 给他的数据，因为它不够快，屏幕的上一帧还没渲染完，下一帧就已经到来了，这就导致画面的撕裂。</p>
<p data-v-468ad0ce data-v-468ad0ce>这个时候我们就要引入 VSync 了，简单来说它就是让显卡保持他的输出速率不高于屏幕的刷新率，启用了 VSync 后，GPU 不再会给你可怜的 60Hz 屏幕每秒发送 100 帧了，它会增加每一帧的发送间隔，确保显示器能够有充足的时间去处理每一帧。</p>
</blockquote>
<p data-v-468ad0ce data-v-468ad0ce><strong data-v-468ad0ce data-v-468ad0ce>双缓冲机制：</strong></p>
<blockquote data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce>双缓冲机制是用于避免或减少画面闪烁的问题，在单缓冲的情况下，GPU 输出了一帧画面，缓冲区就需要马上获取这个画面，并交给显示屏去显示，而这段时间 GPU 输出的画面就全都丢失了，因为没有缓冲区去承载这些画面，就会造成画面的闪烁。</p>
<p data-v-468ad0ce data-v-468ad0ce>而在双缓冲机制下有一个<code data-v-468ad0ce data-v-468ad0ce>Back Frame Buffer</code>和一个<code data-v-468ad0ce data-v-468ad0ce>Front Frame Buffer</code>，在 GPU 绘制完成后，它会将图像先保存到<code data-v-468ad0ce data-v-468ad0ce>Back Frame Buffer</code>中，操作完毕后，会调用一个交换函数，让绘制完成的<code data-v-468ad0ce data-v-468ad0ce>Back Frame Buffer</code>上的图像交换到<code data-v-468ad0ce data-v-468ad0ce>Front Frame Buffer</code>上。由于双缓冲利用了更多显存与 CPU 消耗时间，从而避免了画面的闪烁。</p>
</blockquote>
<h3 id="so？" data-v-468ad0ce data-v-468ad0ce><a href="#so%EF%BC%9F" aria-hidden="true" tabindex="-1" data-v-468ad0ce data-v-468ad0ce><span class="icon icon-link" data-v-468ad0ce data-v-468ad0ce></span></a>So？</h3>
<p data-v-468ad0ce data-v-468ad0ce>相信大家都会遇到过应用卡顿，卡顿的原因就是因为两帧的刷新时间间隔大于 60 帧每秒（约 16.67ms），导致用户感觉点击或者滑动时，界面没有及时的响应。</p>
<p data-v-468ad0ce data-v-468ad0ce>前面提到 <strong data-v-468ad0ce data-v-468ad0ce>Core Animation Pipeline</strong> 是以<strong data-v-468ad0ce data-v-468ad0ce>流水线</strong>的形式工作的，在理想的状况下我们希望它能够在 1/60s 内完成图层树的准备工作并提交给渲染进程，而渲染进程在下一次 VSync 信号到来的时候提交给 GPU 进行渲染，并在 1/60s 内完成渲染，这样就不会产生任何的卡顿。</p>
<p data-v-468ad0ce data-v-468ad0ce>但是由于我们使用了我们的魔法 UIKit，所以我们在许多后台线程进行了 UI 操作，在 runloop 的结尾准备进行渲染的时候，不同线程提交了不同的渲染信息，于是我们就拥有了更多的绘制事务，这个时候 <strong data-v-468ad0ce data-v-468ad0ce>Core Animation Pipeline</strong> 会不断将信息提交，让 GPU 进行渲染，由于绘制事件的不同步导致了 GPU 渲染的不同步，可能在上一帧是需要渲染一个 label 消失的画面，下一帧却又需要渲染这个 label 改变了文字，最终导致的是界面的不同步。</p>
<p data-v-468ad0ce data-v-468ad0ce>（如果你真的想要这样的效果，可以尝试一下使用我的 <a href="https://github.com/Dywane/DWAnimatedLabel" rel="nofollow noopener noreferrer" target="_blank" data-v-468ad0ce data-v-468ad0ce>DWAnimatedLabel</a>）</p>
<p data-v-468ad0ce data-v-468ad0ce>另一方面，在 VSync 和双缓冲机制我们可以看出渲染其实是一个十分消耗系统资源的操作（占用显存与 CPU），所以可能会因为大量的事务和线程之间频繁的上下文切换导致了 GPU 无法处理，反而影响了性能，从而导致在 1/60s 中无法完成图层树的提交，导致了严重的卡顿。</p>
<hr data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce><img alt="" src="https://user-gold-cdn.xitu.io/2019/1/17/1685bae101d2e52b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-v-468ad0ce data-v-468ad0ce></p>
<blockquote data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce>但我真的很想在后台线程操作 UI，我能再用黑魔法吗？</p>
</blockquote>
<p data-v-468ad0ce data-v-468ad0ce><strong data-v-468ad0ce data-v-468ad0ce>……</strong></p>
<p data-v-468ad0ce data-v-468ad0ce><strong data-v-468ad0ce data-v-468ad0ce>……</strong></p>
<p data-v-468ad0ce data-v-468ad0ce><strong data-v-468ad0ce data-v-468ad0ce>……</strong></p>
<p data-v-468ad0ce data-v-468ad0ce><strong data-v-468ad0ce data-v-468ad0ce>……</strong></p>
<p data-v-468ad0ce data-v-468ad0ce><strong data-v-468ad0ce data-v-468ad0ce>好吧，其实是有办法的。</strong></p>
<h2 id="texture-or-componentkit" data-v-468ad0ce data-v-468ad0ce><a href="#texture-or-componentkit" aria-hidden="true" tabindex="-1" data-v-468ad0ce data-v-468ad0ce><span class="icon icon-link" data-v-468ad0ce data-v-468ad0ce></span></a>Texture or ComponentKit</h2>
<p data-v-468ad0ce data-v-468ad0ce><a href="https://github.com/facebookarchive/AsyncDisplayKit" rel="nofollow noopener noreferrer" target="_blank" data-v-468ad0ce data-v-468ad0ce>AsyncDisplayKit（现命名为 Texture）</a> 是 Facebook 开源的一个用于保持 iOS 界面流畅的框架。</p>
<p data-v-468ad0ce data-v-468ad0ce><a href="https://github.com/facebook/componentkit" rel="nofollow noopener noreferrer" target="_blank" data-v-468ad0ce data-v-468ad0ce>ComponentKit</a> 是 Facebook 开源的一个基于 React 思想的 iOS 原生 UI 开发框架。它通过函数式和声明的方式构建 UI。</p>
<p data-v-468ad0ce data-v-468ad0ce>让我们撤销掉我们对 UIKit 施展的各种魔法，回到这个 UI 只能在主线程进行操作的世界吧。这两个框架其实并不是真正的在后台线程操作 UI，而是用了更巧妙的方法将一些耗时的操作异步执行，从而绕开了 UIKit 只能在主线程操作的限制。</p>
<p data-v-468ad0ce data-v-468ad0ce>比如 Texture 创建了各类<code data-v-468ad0ce data-v-468ad0ce>Node</code>，在 node 中包含了 UIView，而 Node 本身是线程安全的，所以允许在后台线程对 Node 进行修改，随后在第一次主线程访问 View 的时候它才会在内部生成对应的 View，当 node 的属性发生改变的时候，他也不会马上进行修改，而是在适当的时机一次性的在主线程为内部的 View 进行设置。（有点类似于绘图循环）</p>
<p data-v-468ad0ce data-v-468ad0ce>而 ComponentKit 则是通过创建 Component 来描述 UI，它也是一个线程安全的类。可以将 Component 认为是一个刻板，而 UIView 是刻板下的一张纸，渲染则是喷墨的过程。当我们生成了一个 Component 的时候，就等于生成了一个 View 的模版，在进行渲染的时候只要按照模版进行绘制就可以了。复杂的界面可以通过各种简单的 Component 来组成。（类似于 Flutter 的 widget）</p>
<hr data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce><img alt="" src="https://user-gold-cdn.xitu.io/2019/1/17/1685bae32ee4a4e8?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" data-v-468ad0ce data-v-468ad0ce></p>
<blockquote data-v-468ad0ce data-v-468ad0ce>
<p data-v-468ad0ce data-v-468ad0ce>但是我……</p>
</blockquote>
<p data-v-468ad0ce data-v-468ad0ce><strong data-v-468ad0ce data-v-468ad0ce>闭嘴吧你</strong></p>
<h2 id="总结" data-v-468ad0ce data-v-468ad0ce><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" tabindex="-1" data-v-468ad0ce data-v-468ad0ce><span class="icon icon-link" data-v-468ad0ce data-v-468ad0ce></span></a>总结</h2>
<p data-v-468ad0ce data-v-468ad0ce>UIKit 不能在主线程进行操作，这一个铁律只要是熟悉 iOS 开发的都会有所耳闻，但是往深一层其实这个涉及到很多的东西，包括软件、整体 UIKit 框架的实现、硬件等等，很多细节的东西往往是我们在平常有所忽略的。可能我们知道不能在主线程操作，却不知道其内在原因；可能我们知道怎么排查、处理卡顿，却不知道其真正的成因；可能我们知道<code data-v-468ad0ce data-v-468ad0ce>drawRect:</code>方法会导致 CPU 飙升，却不知道原因是上下文的切换导致……</p>
<p data-v-468ad0ce data-v-468ad0ce>写代码从来都不是一件简单而显而易见的事情。</p>
<p data-v-468ad0ce data-v-468ad0ce>更多的内容可以查看我的<a href="https://dywane.github.io" rel="nofollow noopener noreferrer" target="_blank" data-v-468ad0ce data-v-468ad0ce>博客</a></p>
<h2 id="参考资料" data-v-468ad0ce data-v-468ad0ce><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" aria-hidden="true" tabindex="-1" data-v-468ad0ce data-v-468ad0ce><span class="icon icon-link" data-v-468ad0ce data-v-468ad0ce></span></a>参考资料</h2>
<ul data-v-468ad0ce data-v-468ad0ce>
<li data-v-468ad0ce data-v-468ad0ce><a href="https://medium.com/@dmytro.anokhin/rendering-performance-of-ios-apps-4d09a9228930" rel="nofollow noopener noreferrer" target="_blank" data-v-468ad0ce data-v-468ad0ce>Rendering performance of iOS apps</a></li>
<li data-v-468ad0ce data-v-468ad0ce><a href="https://www.quora.com/Why-must-the-UI-always-be-updated-on-Main-Thread" rel="nofollow noopener noreferrer" target="_blank" data-v-468ad0ce data-v-468ad0ce>Why must the UI Always be updated on Main Thread</a></li>
<li data-v-468ad0ce data-v-468ad0ce><a href="https://www.objc.io/issues/2-concurrency/thread-safe-class-design/" rel="nofollow noopener noreferrer" target="_blank" data-v-468ad0ce data-v-468ad0ce>Thread-Safe Class Design</a></li>
<li data-v-468ad0ce data-v-468ad0ce><a href="https://blog.ibireme.com/2015/11/12/smooth_user_interfaces_for_ios/" rel="nofollow noopener noreferrer" target="_blank" data-v-468ad0ce data-v-468ad0ce>iOS 保持界面流畅的技巧</a></li>
<li data-v-468ad0ce data-v-468ad0ce><a href="https://developer.apple.com/library/archive/documentation/2DDrawing/Conceptual/DrawingPrintingiOS/GraphicsDrawingOverview/GraphicsDrawingOverview.html" rel="nofollow noopener noreferrer" target="_blank" data-v-468ad0ce data-v-468ad0ce>iOS Drawing Concepts</a></li>
<li data-v-468ad0ce data-v-468ad0ce><a href="https://componentkit.org" rel="nofollow noopener noreferrer" target="_blank" data-v-468ad0ce data-v-468ad0ce>ComponentKit</a></li>
<li data-v-468ad0ce data-v-468ad0ce><a href="https://github.com/facebookarchive/AsyncDisplayKit" rel="nofollow noopener noreferrer" target="_blank" data-v-468ad0ce data-v-468ad0ce>Texture</a></li>
</ul></div></div> <div class="sidebar co-width-2" style="padding-left:12px;display:none" data-v-468ad0ce><div class="toc-fixed" data-v-468ad0ce><nav id="TableOfContents" data-v-468ad0ce><ul data-v-468ad0ce><li class="py-2" style="text-indent:8px" data-v-468ad0ce><a href="#从-uikit-线程不安全说起" data-v-468ad0ce> 从 UIKit 线程不安全说起 </a></li><li class="py-2" style="text-indent:8px" data-v-468ad0ce><a href="#runloop-与绘图循环" data-v-468ad0ce> Runloop 与绘图循环 </a></li><li class="py-2" style="text-indent:8px" data-v-468ad0ce><a href="#理解-ios-的渲染流程" data-v-468ad0ce> 理解 iOS 的渲染流程 </a></li><li class="ml-2 pb-2" style="text-indent:16px" data-v-468ad0ce><a href="#渲染系统框架" data-v-468ad0ce> 渲染系统框架 </a></li><li class="ml-2 pb-2" style="text-indent:16px" data-v-468ad0ce><a href="#core-animation-pipeline-流水线" data-v-468ad0ce> Core Animation Pipeline 流水线 </a></li><li class="ml-2 pb-2" style="text-indent:16px" data-v-468ad0ce><a href="#so？" data-v-468ad0ce> So？ </a></li><li class="py-2" style="text-indent:8px" data-v-468ad0ce><a href="#texture-or-componentkit" data-v-468ad0ce> Texture or ComponentKit </a></li><li class="py-2" style="text-indent:8px" data-v-468ad0ce><a href="#总结" data-v-468ad0ce> 总结 </a></li><li class="py-2" style="text-indent:8px" data-v-468ad0ce><a href="#参考资料" data-v-468ad0ce> 参考资料 </a></li></ul></nav> <a href="#" id="tap-to-top" data-v-468ad0ce><fa icon="fa,arrow-up" data-v-468ad0ce></fa></a></div></div></aside></article></section></div></div></main></div></div><script defer src="/_nuxt/static/1637221111/wiki/content/%E9%97%AE%E4%B8%8E%E7%AD%94-%E4%B8%BA%E4%BB%80%E4%B9%88ui%E6%93%8D%E4%BD%9C%E8%A6%81%E5%9C%A8%E4%B8%BB%E7%BA%BF%E7%A8%8B/state.js"></script><script src="/_nuxt/js/runtime.1637221086066.js" defer></script><script src="/_nuxt/js/pages/wiki.1637221086066.js" defer></script><script src="/_nuxt/js/pages/wiki/content/_slug.1637221086066.js" defer></script><script src="/_nuxt/js/commons/app.1637221086066.js" defer></script><script src="/_nuxt/js/vendors/app.1637221086066.js" defer></script><script src="/_nuxt/js/app.1637221086066.js" defer></script>
  </body>
</html>

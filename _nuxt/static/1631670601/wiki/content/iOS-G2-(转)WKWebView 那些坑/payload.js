__NUXT_JSONP__("/wiki/content/iOS-G2-(%E8%BD%AC)WKWebView%20%E9%82%A3%E4%BA%9B%E5%9D%91", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL,cM,cN,cO,cP,cQ,cR,cS,cT,cU,cV,cW,cX,cY,cZ,c_,c$,da,db,dc,dd,de,df,dg,dh,di,dj,dk,dl,dm,dn){return {data:[{},{article:{slug:bl,title:bm,layout:"page",date:aJ,toc:[{id:aK,depth:ac,text:aK},{id:bn,depth:ac,text:bo},{id:bp,depth:ac,text:bq},{id:br,depth:as,text:bs},{id:bt,depth:as,text:bu},{id:bv,depth:as,text:bw},{id:bx,depth:ac,text:by},{id:bz,depth:ac,text:bA},{id:bB,depth:ac,text:bC},{id:bD,depth:ac,text:bE},{id:bF,depth:ac,text:bG},{id:aL,depth:ac,text:aL},{id:bH,depth:as,text:bI},{id:bJ,depth:as,text:bK},{id:bL,depth:as,text:bM},{id:aM,depth:ac,text:aM}],body:{type:"root",children:[{type:b,tag:n,props:{},children:[{type:b,tag:z,props:{href:"https:\u002F\u002Fcloud.tencent.com\u002Fdeveloper\u002Farticle\u002F1071660",rel:[U,V,W],target:X},children:[{type:a,value:"原文地址"}]},{type:a,value:" 文章年代略久，但总全面，可以作参考。"}]},{type:a,value:h},{type:b,tag:ad,props:{id:aK},children:[{type:b,tag:z,props:{href:"#%E5%AF%BC%E8%AF%AD",ariaHidden:K,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:aK}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"WKWebView 是苹果在 WWDC 2014 上推出的新一代 webView 组件，用以替代 UIKit 中笨重难用、内存泄漏的 UIWebView。WKWebView 拥有60fps滚动刷新率、和 safari 相同的 JavaScript 引擎等优势。"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"简单的适配方法本文不再赘述，主要来说说适配 WKWebView 过程中填过的坑以及善待解决的技术难题。"}]},{type:a,value:h},{type:b,tag:ad,props:{id:bn},children:[{type:b,tag:z,props:{href:"#1%E3%80%81wkwebview-%E7%99%BD%E5%B1%8F%E9%97%AE%E9%A2%98",ariaHidden:K,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:bo}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"WKWebView 自诩拥有更快的加载速度，更低的内存占用，但实际上 WKWebView 是一个多进程组件，Network Loading 以及 UI Rendering 在其它进程中执行。初次适配 WKWebView 的时候，我们也惊讶于打开 WKWebView 后，App 进程内存消耗反而大幅下降，但是仔细观察会发现，Other Process 的内存占用会增加。在一些用 webGL 渲染的复杂页面，使用 WKWebView 总体的内存占用（App Process Memory + Other Process Memory）不见得比 UIWebView 少很多。"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"在 UIWebView 上当内存占用太大的时候，App Process 会 crash；而在 WKWebView 上当总体的内存占用比较大的时候，WebContent Process 会 crash，从而出现白屏现象。在 WKWebView 中加载下面的测试链接可以稳定重现白屏现象:"}]},{type:a,value:h},{type:b,tag:"blockquote",props:{},children:[{type:a,value:h},{type:b,tag:n,props:{},children:[{type:b,tag:z,props:{href:bN,rel:[U,V,W],target:X},children:[{type:a,value:bN}]}]},{type:a,value:h}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"这个时候 WKWebView.URL 会变为 nil, 简单的 reload 刷新操作已经失效，对于一些长驻的H5页面影响比较大。"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"我们最后的解决方案是："}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"A、"},{type:b,tag:ai,props:{},children:[{type:a,value:"借助 WKNavigtionDelegate"}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"iOS 9以后 WKNavigtionDelegate 新增了一个回调函数："}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,aA]},children:[{type:b,tag:x,props:{},children:[{type:a,value:"- (void)webViewWebContentProcessDidTerminate:(WKWebView *)webView API_AVAILABLE(macosx(10.11), ios(9.0));\n"}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"当 WKWebView 总体内存占用过大，页面即将白屏的时候，系统会调用上面的回调函数，我们在该函数里执行"},{type:b,tag:x,props:{},children:[{type:a,value:"[webView reload]"}]},{type:a,value:"(这个时候 webView.URL 取值尚不为 nil）解决白屏问题。在一些高内存消耗的页面可能会频繁刷新当前页面，H5侧也要做相应的适配操作。"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"B、"},{type:b,tag:ai,props:{},children:[{type:a,value:"检测 webView.title 是否为空"}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"并不是所有H5页面白屏的时候都会调用上面的回调函数，比如，最近遇到在一个高内存消耗的H5页面上 present 系统相机，拍照完毕后返回原来页面的时候出现白屏现象（拍照过程消耗了大量内存，导致内存紧张，WebContent Process 被系统挂起），但上面的回调函数并没有被调用。在WKWebView白屏的时候，另一种现象是 webView.titile 会被置空, 因此，可以在 viewWillAppear 的时候检测 webView.title 是否为空来 reload 页面。"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"综合以上两种方法可以解决绝大多数的白屏问题。"}]},{type:a,value:h},{type:b,tag:ad,props:{id:bp},children:[{type:b,tag:z,props:{href:"#2%E3%80%81wkwebview-cookie-%E9%97%AE%E9%A2%98",ariaHidden:K,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:bq}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"Cookie 问题是目前 WKWebView 的一大短板"}]},{type:a,value:h},{type:b,tag:at,props:{id:br},children:[{type:b,tag:z,props:{href:"#21%E3%80%81wkwebview-cookie%E5%AD%98%E5%82%A8",ariaHidden:K,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:bs}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:b,tag:ai,props:{},children:[{type:a,value:"业界普遍认为 WKWebView 拥有自己的私有存储"}]},{type:a,value:"，不会将 Cookie 存入到标准的 Cookie 容器 NSHTTPCookieStorage 中。"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"实践发现 WKWebView 实例其实也会将 Cookie 存储于 NSHTTPCookieStorage 中，但存储时机有延迟:"}]},{type:a,value:h},{type:b,tag:"ul",props:{},children:[{type:a,value:h},{type:b,tag:au,props:{},children:[{type:a,value:"在iOS 8上，当页面跳转的时候，当前页面的 Cookie 会写入 NSHTTPCookieStorage 中"}]},{type:a,value:h},{type:b,tag:au,props:{},children:[{type:a,value:"在 iOS 10 上，JS 执行 document.cookie 或服务器 set-cookie 注入的 Cookie 会很快同步到 NSHTTPCookieStorage 中，FireFox 工程师曾建议通过 reset WKProcessPool 来触发 Cookie 同步到 NSHTTPCookieStorage 中，实践发现不起作用，并可能会引发当前页面 session cookie 丢失等问题。"}]},{type:a,value:h}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"WKWebView Cookie 问题在于:"},{type:b,tag:ai,props:{},children:[{type:a,value:"WKWebView 发起的请求不会自动带上存储于 NSHTTPCookieStorage 容器中的 Cookie"}]},{type:a,value:"。"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"比如，NSHTTPCookieStorage 中存储了一个 Cookie:"}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,av]},children:[{type:b,tag:x,props:{},children:[{type:a,value:bO},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"Nicholas"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:bP},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:"test"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:bQ},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:bR},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,aB]},children:[{type:a,value:"qq"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,aB]},children:[{type:a,value:"com"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:bS},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"Sat"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"02"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"May"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"2019"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"23"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"38"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"25"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,aY]},children:[{type:a,value:"GMT"}]},{type:a,value:"；\n"}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"通过 UIWebView 发起请求"},{type:b,tag:z,props:{href:bT,rel:[U,V,W],target:X},children:[{type:a,value:bU}]},{type:a,value:" 则请求头会自动带上 cookie: Nicholas=test；\n而通过 WKWebView发起请求"},{type:b,tag:z,props:{href:bT,rel:[U,V,W],target:X},children:[{type:a,value:bU}]},{type:a,value:" 请求头"},{type:b,tag:ai,props:{},children:[{type:a,value:"不会"}]},{type:a,value:"自动带上 cookie: Nicholas=test。"}]},{type:a,value:h},{type:b,tag:at,props:{id:bt},children:[{type:b,tag:z,props:{href:"#22%E3%80%81wkprocesspool",ariaHidden:K,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:bu}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"苹果开发者文档对 WKProcessPool 的定义是："},{type:b,tag:x,props:{},children:[{type:a,value:"A WKProcessPool object represents a pool of Web Content process"}]},{type:a,value:". 通过让所有 WKWebView 共享同一个 WKProcessPool 实例，可以"},{type:b,tag:ai,props:{},children:[{type:a,value:"实现多个 WKWebView 之间共享 Cookie（session Cookie and persistent Cookie）数据"}]},{type:a,value:"。不过 WKWebView WKProcessPool 实例在 app 杀进程重启后会被重置，导致 WKProcessPool 中的 Cookie、session Cookie 数据丢失，目前也无法实现 WKProcessPool 实例本地化保存。"}]},{type:a,value:h},{type:b,tag:at,props:{id:bv},children:[{type:b,tag:z,props:{href:"#23%E3%80%81workaround",ariaHidden:K,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:bw}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"由于许多 H5 业务都依赖于 Cookie 作登录态校验，而 WKWebView 上请求不会自动携带 Cookie, 目前的主要解决方案是："}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"a、WKWebView loadRequest 前，在 request header 中设置 Cookie, 解决首个请求 Cookie 带不上的问题；"}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,aA]},children:[{type:b,tag:x,props:{},children:[{type:a,value:"WKWebView * webView = [WKWebView new]; \nNSMutableURLRequest * request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@\"http:\u002F\u002Fh5.qzone.qq.com\u002Fmqzone\u002Findex\"]]; \n[request addValue:@\"skey=skeyValue\" forHTTPHeaderField:@\"Cookie\"]; \n[webView loadRequest:request];\n"}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"b、通过 document.cookie 设置 Cookie 解决后续页面(同域)Ajax、iframe 请求的 Cookie 问题；"},{type:b,tag:ai,props:{},children:[{type:a,value:"注意：document.cookie()无法跨域设置 cookie"}]}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,av]},children:[{type:b,tag:x,props:{},children:[{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:bV}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:" userContentController "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:bV}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:"new"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:aZ}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:" cookieScript "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:aZ}]},{type:a,value:" alloc"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:" initWithSource"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:" @"},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"\"document.cookie = 'skey=skeyValue';\""}]},{type:a,value:bW},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"WKUserScriptInjectionTimeAtDocumentStart"}]},{type:a,value:bX},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,aY]},children:[{type:a,value:"NO"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:" \n\n"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:"userContentController addUserScript"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:"cookieScript"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"这种方案无法解决302请求的 Cookie 问题，比如，第一个请求是 "},{type:b,tag:z,props:{href:"http:\u002F\u002Fwww.a.com%EF%BC%8C%E6%88%91%E4%BB%AC%E9%80%9A%E8%BF%87%E5%9C%A8",rel:[U,V,W],target:X},children:[{type:a,value:"www.a.com，我们通过在"}]},{type:a,value:" request header 里带上 Cookie 解决该请求的 Cookie 问题，接着页面302跳转到 "},{type:b,tag:z,props:{href:"http:\u002F\u002Fwww.b.com%EF%BC%8C%E8%BF%99%E4%B8%AA%E6%97%B6%E5%80%99",rel:[U,V,W],target:X},children:[{type:a,value:"www.b.com，这个时候"}]},{type:a,value:f},{type:b,tag:z,props:{href:"http:\u002F\u002Fwww.b.com",rel:[U,V,W],target:X},children:[{type:a,value:"www.b.com"}]},{type:a,value:" 这个请求就可能因为没有携带 cookie 而无法访问。当然，由于每一次页面跳转前都会调用回调函数："}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,aA]},children:[{type:b,tag:x,props:{},children:[{type:a,value:"- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler;\n"}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:k},{type:b,tag:z,props:{href:"https:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F47754208\u002Fwkwebview-backforwardlist-getting-messed-up-when-going-back",rel:[U,V,W],target:X},children:[{type:a,value:"笔者注:但是可能会造成调用goback的循环"}]},{type:a,value:",笔者认为是否可以可以判断如果backlist包含了此网址，就不进行cancel再拼接，但是仍然不完美,示例如下)。"}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,bY]},children:[{type:b,tag:x,props:{},children:[{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aq}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:bZ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aC},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aD}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aw}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aD}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:b_}]},{type:a,value:" fixeReq"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aN}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:_}]},{type:a,value:" mReq "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:b$},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aN}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:"\n            fixeReq "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:" mReq\n        "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aO}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:_}]},{type:a,value:" q "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:a_},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:"mutableCopy"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aN}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:"\n                fixeReq "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:" q\n            "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,ae]},children:[{type:a,value:"\u002F\u002Fadd cookie"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,ae]},children:[{type:a,value:"\u002F\u002FfixeReq.addValue(self.generateCookieKeyValue(cookieDic), forHTTPHeaderField: \"Cookie\")"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:_}]},{type:a,value:ca},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:ca},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aj}]},{type:a,value:" fixeReq\n        "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aj}]},{type:a,value:" request\n    "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:aP},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aq}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:cb}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aC},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aD}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aw}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"Bool"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:_}]},{type:a,value:" keys "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:a_},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:cc},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"keys "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Y}]},{type:a,value:" keys"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:cd}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:a$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:aQ},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:_}]},{type:a,value:" value "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:a_},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:cc},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:a$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:ce},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Y}]},{type:a,value:cf},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:cd}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ba}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:"\n                        "},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aj}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,bb]},children:[{type:a,value:K}]},{type:a,value:ce},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:aQ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aj}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,bb]},children:[{type:a,value:cg}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aq}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:ak}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aR}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aS}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:" decidePolicyFor navigationAction"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"WKNavigationAction"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:" decisionHandler"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:" @escaping "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"WKNavigationActionPolicy"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aw}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"Void"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,ae]},children:[{type:a,value:"\u002F\u002F但是这样写会造成 goback循环"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:cb}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aC},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:ch},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:ci},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ax}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aD}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:cj}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"allow"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aO}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:"\n            webView"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:bc}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:bZ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aC},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:ch},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:ci},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ax}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aD}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ax}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:bd}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:cj}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"cancel"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"可以在该回调函数里拦截302请求，copy request，在 request header 中带上 cookie 并重新 loadRequest。不过这种方法依然解决不了页面 iframe 跨域请求的 Cookie 问题，毕竟"},{type:b,tag:x,props:{},children:[{type:a,value:"-[WKWebView loadRequest:]"}]},{type:a,value:"只适合加载 mainFrame 请求。"}]},{type:a,value:h},{type:b,tag:ad,props:{id:bx},children:[{type:b,tag:z,props:{href:"#3%E3%80%81wkwebview-nsurlprotocol%E9%97%AE%E9%A2%98",ariaHidden:K,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:by}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"WKWebView 在独立于 app 进程之外的进程中执行网络请求，请求数据不经过主进程，因此，在 WKWebView 上直接使用 NSURLProtocol 无法拦截请求。苹果开源的 webKit2 源码暴露了私有API："}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,av]},children:[{type:b,tag:x,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aF}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"WKBrowsingContextController"}]},{type:a,value:" registerSchemeForCustomProtocol"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"通过注册 http(s) scheme 后 WKWebView 将可以使用 NSURLProtocol 拦截 http(s) 请求："}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,aA]},children:[{type:b,tag:x,props:{},children:[{type:a,value:"Class cls = NSClassFromString(@\"WKBrowsingContextController”); \nSEL sel = NSSelectorFromString(@\"registerSchemeForCustomProtocol:\"); \nif ([(id)cls respondsToSelector:sel]) { \n           \u002F\u002F 注册http(s) scheme, 把 http和https请求交给 NSURLProtocol处理 \n           [(id)cls performSelector:sel withObject:@\"http\"]; \n           [(id)cls performSelector:sel withObject:@\"https\"]; \n}\n"}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"但是这种方案目前存在两个严重缺陷："}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"a、post 请求 body 数据被清空\n由于 WKWebView 在独立进程里执行网络请求。一旦注册 http(s) scheme 后，网络请求将从 Network Process 发送到 App Process，这样 NSURLProtocol 才能拦截网络请求。在 webkit2 的设计里使用 MessageQueue 进行进程之间的通信，Network Process 会将请求 encode 成一个 Message,然后通过 IPC 发送给 App Process。出于性能的原因，encode 的时候 HTTPBody 和 HTTPBodyStream 这两个字段被丢弃掉了"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"参考："},{type:b,tag:z,props:{href:"https:\u002F\u002Fgithub.com\u002FWebKit\u002Fwebkit\u002Fblob\u002Ffe39539b83d28751e86077b173abd5b7872ce3f9\u002FSource\u002FWebKit2\u002FShared\u002Fmac\u002FWebCoreArgumentCodersMac.mm#L61-L88",rel:[U,V,W],target:X},children:[{type:a,value:"苹果源码"}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"及bug report:"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:b,tag:z,props:{href:ck,rel:[U,V,W],target:X},children:[{type:a,value:ck}]},{type:a,value:" （复制链接到浏览器中打开）"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"因此，如果通过 registerSchemeForCustomProtocol 注册了 http(s) scheme, 那么由 WKWebView 发起的所有 http(s)请求都会通过 IPC 传给主进程 NSURLProtocol 处理，导致 post 请求 body 被清空；"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"b、对ATS支持不足\n测试发现一旦打开ATS开关：Allow Arbitrary Loads 选项设置为NO，同时通过 registerSchemeForCustomProtocol 注册了 http(s) scheme，WKWebView 发起的所有 http 网络请求将被阻塞（即便将Allow Arbitrary Loads in Web Content 选项设置为YES）；"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"WKWebView 可以注册 customScheme, 比如 dynamic:\u002F\u002F, 因此希望使用离线功能又不使用 post 方式的请求可以通过 customScheme 发起请求，比如 dynamic:\u002F\u002F"},{type:b,tag:z,props:{href:"http:\u002F\u002Fwww.dynamicalbumlocalimage.com\u002F%EF%BC%8C%E7%84%B6%E5%90%8E%E5%9C%A8",rel:[U,V,W],target:X},children:[{type:a,value:"www.dynamicalbumlocalimage.com\u002F，然后在"}]},{type:a,value:" app 进程 NSURLProtocol 拦截这个请求并加载离线数据。不足：使用 post 方式的请求该方案依然不适用，同时需要 H5 侧修改请求 scheme 以及 CSP 规则；"}]},{type:a,value:h},{type:b,tag:ad,props:{id:bz},children:[{type:b,tag:z,props:{href:"#4%E3%80%81wkwebview-loadrequest-%E9%97%AE%E9%A2%98",ariaHidden:K,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:bA}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"在 WKWebView 上通过 loadRequest 发起的 post 请求 body 数据会丢失："}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,aA]},children:[{type:b,tag:x,props:{},children:[{type:a,value:"\u002F\u002F同样是由于进程间通信性能问题，HTTPBody字段被丢弃\n[request setHTTPMethod:@\"POST\"];\n[request setHTTPBody:[@\"bodyData\" dataUsingEncoding:NSUTF8StringEncoding]];\n[wkwebview loadRequest: request];\n"}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"workaround:\n假如想通过-[WKWebView loadRequest:]加载 post 请求 request1: "},{type:b,tag:x,props:{},children:[{type:a,value:cl}]},{type:a,value:",可以通过以下步骤实现："}]},{type:a,value:h},{type:b,tag:"ol",props:{},children:[{type:a,value:h},{type:b,tag:au,props:{},children:[{type:a,value:"替换请求 scheme，生成新的 post 请求 request2: "},{type:b,tag:x,props:{},children:[{type:a,value:cm}]},{type:a,value:", 同时将 request1 的 body 字段复制到 request2 的 header 中（WebKit 不会丢弃 header 字段）;"}]},{type:a,value:h},{type:b,tag:au,props:{},children:[{type:a,value:"通过-[WKWebView loadRequest:]加载新的 post 请求 request2;"}]},{type:a,value:h},{type:b,tag:au,props:{},children:[{type:a,value:"通过 +[WKBrowsingContextController registerSchemeForCustomProtocol:]注册 scheme: "},{type:b,tag:x,props:{},children:[{type:a,value:"post:\u002F\u002F"}]},{type:a,value:y}]},{type:a,value:h},{type:b,tag:au,props:{},children:[{type:a,value:"注册 NSURLProtocol 拦截请求"},{type:b,tag:x,props:{},children:[{type:a,value:cm}]},{type:a,value:" ,替换请求 scheme, 生成新的请求 request3: "},{type:b,tag:x,props:{},children:[{type:a,value:cl}]},{type:a,value:"，将 request2 header的body 字段复制到 request3 的 body 中，并使用 NSURLConnection 加载 request3，最后通过 NSURLProtocolClient 将加载结果返回 WKWebView;"}]},{type:a,value:h}]},{type:a,value:h},{type:b,tag:ad,props:{id:bB},children:[{type:b,tag:z,props:{href:"#5%E3%80%81wkwebview-%E9%A1%B5%E9%9D%A2%E6%A0%B7%E5%BC%8F%E9%97%AE%E9%A2%98",ariaHidden:K,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:bC}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"在 WKWebView 适配过程中，我们发现部分H5页面元素位置向下偏移或被拉伸变形，追踪后发现主要是H5页面高度值异常导致："}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"a. 空间H5页面有透明导航、透明导航下拉刷新、全屏等需求，因此之前 webView 整个是从（0, 0）开始布局，通过调整webView.scrollView.contentInset 来适配特殊导航栏需求。而在 WKWebView 上对 contentInset 的调整会反馈到"},{type:b,tag:x,props:{},children:[{type:a,value:"webView.scrollView.contentSize.height"}]},{type:a,value:"的变化上，比如设置 "},{type:b,tag:x,props:{},children:[{type:a,value:"webView.scrollView.contentInset.top = a"}]},{type:a,value:"，那么contentSize.height的值会增加a,导致H5页面长度增加，页面元素位置向下偏移；"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"解决方案是：调整WKWebView布局方式，避免调整webView.scrollView.contentInset。实际上，即便在 UIWebView 上也不建议直接调整webView.scrollView.contentInset的值，这确实会带来一些奇怪的问题。如果某些特殊情况下非得调整 contentInset 不可的话，可以通过下面方式让H5页面恢复正常显示："}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,al]},children:[{type:b,tag:x,props:{},children:[{type:b,tag:c,props:{className:[d,"doc-comment",ae]},children:[{type:a,value:"\u002F**\n * 设置contentInset值后通过调整webView.frame让页面恢复正常显示 \n * 参考：http:\u002F\u002Fkm.oa.com\u002Farticles\u002Fshow\u002F277372\n *\u002F"}]},{type:a,value:cn},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"scrollView"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"contentInset "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"UIEdgeInsetsMake"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aT}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aT}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aT}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:cn},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"frame "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"CGRectMake"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:co},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"x"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:co},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bR},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:be},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"width"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:be},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:cp},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:a,value:" a"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"b. 在接入 now 直播的时候，我们发现在 iOS 9 上 WKWebView 会出现页面被拉伸变形的情况，最后发现是"},{type:b,tag:x,props:{},children:[{type:a,value:"window.innerHeight"}]},{type:a,value:"值不准确导致（在WKWebView上返回了一个非常大的值），而H5同学通过获取window.innerHeight来设置页面高度，导致页面整体被拉伸。通过查阅相关资料发现，这个bug只在 iOS 9 的几个系统版本上出现，苹果后来fix了这个bug。我们最后的解决方案是："},{type:b,tag:ai,props:{},children:[{type:a,value:"延迟调用window.innerHeight"}]}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,av]},children:[{type:b,tag:x,props:{},children:[{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:"setTimeout"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:o}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:cp},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,"dom",L]},children:[{type:a,value:"window"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,aB]},children:[{type:a,value:"innerHeight"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aT}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"or"}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,av]},children:[{type:b,tag:x,props:{},children:[{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"Use"}]},{type:a,value:" shrink"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:a,value:"to"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:a,value:"fit meta"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:a,value:"tag \n"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:"\u003C"}]},{type:a,value:"meta name"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"\"viewport\""}]},{type:a,value:" content"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"\"width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1, shrink-to-fit=no\""}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aw}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:ad,props:{id:bD},children:[{type:b,tag:z,props:{href:"#6-wkwebview-%E6%88%AA%E5%B1%8F%E9%97%AE%E9%A2%98",ariaHidden:K,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:bE}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"空间玩吧H5小游戏有截屏分享的功能，WKWebView 下通过 -[CALayer renderInContext:]实现截屏的方式失效，需要通过以下方式实现截屏功能："}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,al]},children:[{type:b,tag:x,props:{},children:[{type:b,tag:c,props:{className:[d,bf,e]},children:[{type:a,value:"@implementation"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:cq}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"ImageSnapshot"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:cr}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"imageSnapshot "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"UIGraphicsBeginImageContextWithOptions"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"bounds"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:be},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:cs},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"contentScaleFactor"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:"self drawViewHierarchyInRect"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"bounds afterScreenUpdates"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:cs},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:cr}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:" newImage "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"UIGraphicsGetImageFromCurrentImageContext"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"UIGraphicsEndImageContext"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aj}]},{type:a,value:" newImage"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,bf,e]},children:[{type:a,value:"@end"}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"然而这种方式依然解决不了 webGL 页面的截屏问题，笔者已经翻遍苹果文档，研究过 webKit2 源码里的截屏私有API，依然没有找到合适的解决方案，同时发现 Safari 以及 Chrome 这两个全量切换到 WKWebView 的浏览器也存在同样的问题：对webGL 页面的截屏结果不是空白就是纯黑图片。无奈之下，我们只能约定一个JS接口，让游戏开发商实现该接口，具体是通过 "},{type:b,tag:x,props:{},children:[{type:a,value:"canvas getImageData()"}]},{type:a,value:"方法取得图片数据后返回 base64 格式的数据，客户端在需要截图的时候，调用这个JS接口获取 base64 String 并转换成 UIImage。"}]},{type:a,value:h},{type:b,tag:ad,props:{id:bF},children:[{type:b,tag:z,props:{href:"#7wkwebview-crash%E9%97%AE%E9%A2%98",ariaHidden:K,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:bG}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"WKWebView 放量后，外网新增了一些 crash, 其中一类 crash 的主要堆栈如下："}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,av]},children:[{type:b,tag:x,props:{},children:[{type:b,tag:c,props:{className:[d,"spread",g]},children:[{type:a,value:"..."}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"28"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"UIKit"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"0x0000000190513360"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"UIApplicationMain"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aF}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"208"}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"29"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"Qzone"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"0x0000000101380570"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:ct}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:ct},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,aB]},children:[{type:a,value:"m"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"181"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"30"}]},{type:a,value:" libdyld"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,aB]},children:[{type:a,value:"dylib"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"0x00000001895205b8"}]},{type:a,value:" _dyld_process_info_notify_release "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aF}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"36"}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"Completion"}]},{type:a,value:" handler passed to "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,S]},children:[{type:a,value:"QZWebController"}]},{type:a,value:aE},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:"runJavaScriptAlertPanelWithMessage"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:"initiatedByFrame"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:ag},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:" was not called\n"}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"主要是JS调用window.alert()函数引起的，从 crash 堆栈可以看出是 WKWebView 回调函数:"}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,al]},children:[{type:b,tag:x,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aF}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:" presentAlertOnController"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:cu},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"UIViewController"}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"parentController title"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:cv},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aG}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"title message"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:cv},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aG}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"message handler"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:cu},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:$}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:ag},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"completionHandler 没有被调用导致的。在适配 WKWebView 的时候，我们需要自己实现该回调函数，window.alert()才能调起 alert 框，我们最初的实现是这样的："}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,al]},children:[{type:b,tag:x,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aS}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:cw},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aG}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:cx},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:cy}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:cz},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:$}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:bg},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aV}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:cA},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aV}]},{type:a,value:cB},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ay}]},{type:a,value:cC},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:cD},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:cE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:cF},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aW}]},{type:a,value:cG},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:cH}]},{type:a,value:cI},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:cJ}]},{type:a,value:cK},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aW}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:cL},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:ag}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:cM},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:cN},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:cO},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"如果 WKWebView 退出的时候，JS刚好执行了window.alert(), alert 框可能弹不出来，completionHandler 最后没有被执行，导致 crash；另一种情况是在 WKWebView 一打开，JS就执行window.alert()，这个时候由于 WKWebView 所在的 UIViewController 出现（push或present）的动画尚未结束，alert 框可能弹不出来，completionHandler 最后没有被执行，导致 crash。我们最终的实现大致是这样的："}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,al]},children:[{type:b,tag:x,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aS}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:cw},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aG}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:cx},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:cy}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:cz},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:$}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:bg},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,ae]},children:[{type:a,value:"\u002F*UIViewController of WKWebView has finish push or present animation*\u002F"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:ag}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aj}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aV}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:cA},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aV}]},{type:a,value:cB},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ay}]},{type:a,value:cC},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:cD},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:cE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:cF},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aW}]},{type:a,value:cG},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:cH}]},{type:a,value:cI},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:cJ}]},{type:a,value:cK},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aW}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:cL},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:ag}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,ae]},children:[{type:a,value:"\u002F*UIViewController of WKWebView is visible*\u002F"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:cM},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:cN},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:cO},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aO}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:ag}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"确保上面两种情况下 completionHandler 都能被执行，消除了 WKWebView 下弹 alert 框的 crash，WKWebView 下弹 confirm 框的 crash 的原因与解决方式与 alert 类似。"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"另一个 crash 发生在 WKWebView 退出前调用："}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,al]},children:[{type:b,tag:x,props:{},children:[{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aS}]},{type:a,value:" evaluateJavaScript"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:" completionHandler"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"执行JS代码的情况下。WKWebView 退出并被释放后导致completionHandler变成野指针，而此时 javaScript Core 还在执行JS代码，待 javaScript Core 执行完毕后会调用completionHandler()，导致 crash。这个 crash 只发生在 iOS 8 系统上，参考Apple Open Source，在iOS9及以后系统苹果已经修复了这个bug，主要是对completionHandler block做了copy（refer: "},{type:b,tag:z,props:{href:"https:\u002F\u002Ftrac.webkit.org\u002Fchangeset\u002F179160%EF%BC%89%EF%BC%9B%E5%AF%B9%E4%BA%8EiOS",rel:[U,V,W],target:X},children:[{type:a,value:"https:\u002F\u002Ftrac.webkit.org\u002Fchangeset\u002F179160）；对于iOS"}]},{type:a,value:" 8系统，可以通过在 completionHandler 里 retain WKWebView 防止 completionHandler 被过早释放。我们最后用 methodSwizzle hook 了这个系统方法："}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,al]},children:[{type:b,tag:x,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aF}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:" load \n"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:" \n     "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:"self jr_swizzleMethod"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"NSSelectorFromString"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"\"evaluateJavaScript:completionHandler:\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:" withMethod"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,bf,e]},children:[{type:a,value:"@selector"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:cP},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:ag},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:" error"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:cQ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,ae]},children:[{type:a,value:"\u002F* \n * fix: WKWebView crashes on deallocation if it has pending JavaScript evaluation \n *\u002F"}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:cP},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:aG}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:cR},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:$}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"id"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:cS}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:bg},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:" \n    id strongSelf "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:" self"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:"self altEvaluateJavaScript"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:a,value:cR},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"id r"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:cS}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:"e"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:"strongSelf title"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:ag},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:" \n            "},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:ag}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"r"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:" e"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:Q},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:T},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:ad,props:{id:aL},children:[{type:b,tag:z,props:{href:"#8%E3%80%81%E5%85%B6%E5%AE%83%E9%97%AE%E9%A2%98",ariaHidden:K,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:aL}]},{type:a,value:h},{type:b,tag:at,props:{id:bH},children:[{type:b,tag:z,props:{href:"#81%E3%80%81%E8%A7%86%E9%A2%91%E8%87%AA%E5%8A%A8%E6%92%AD%E6%94%BE",ariaHidden:K,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:bI}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"WKWebView 需要通过WKWebViewConfiguration.mediaPlaybackRequiresUserAction设置是否允许自动播放，但一定要在 WKWebView 初始化之前设置，在 WKWebView 初始化之后设置无效。"}]},{type:a,value:h},{type:b,tag:at,props:{id:bJ},children:[{type:b,tag:z,props:{href:"#82%E3%80%81goback-api%E9%97%AE%E9%A2%98",ariaHidden:K,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:bK}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"WKWebView 上调用 -[WKWebView goBack], 回退到上一个页面后不会触发window.onload()函数、不会执行JS。"}]},{type:a,value:h},{type:b,tag:at,props:{id:bL},children:[{type:b,tag:z,props:{href:"#83%E3%80%81%E9%A1%B5%E9%9D%A2%E6%BB%9A%E5%8A%A8%E9%80%9F%E7%8E%87",ariaHidden:K,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:bM}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"WKWebView 需要通过scrollView delegate调整滚动速率："}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,al]},children:[{type:b,tag:x,props:{},children:[{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"scrollViewWillBeginDragging"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"UIScrollView"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"scrollView "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:"\n     scrollView"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"decelerationRate "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,v]},children:[{type:a,value:"UIScrollViewDecelerationRateNormal"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:y}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:h}]}]}]},{type:a,value:h},{type:b,tag:ad,props:{id:aM},children:[{type:b,tag:z,props:{href:"#9%E3%80%81%E7%BB%93%E8%AF%AD",ariaHidden:K,tabIndex:M},children:[{type:b,tag:c,props:{className:[N,O]},children:[]}]},{type:a,value:aM}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"本文总结了在 WKWebView 上踩过的一些坑。虽然 WKWebView 坑比较多，但是相对 UIWebView 在内存消耗、稳定性方面还是有很大的优势。尽管苹果对 WKWebView 的开发进度过于缓慢，但相信 WKWebView 才是未来。"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"笔者其他参考"}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:b,tag:z,props:{href:"https:\u002F\u002Fwww.jianshu.com\u002Fp\u002F870dba42ec15",rel:[U,V,W],target:X},children:[{type:a,value:"iOS中UIWebView与WKWebView、JavaScript与OC交互、Cookie管理看我就够（中）"}]}]},{type:a,value:h},{type:b,tag:n,props:{},children:[{type:a,value:"笔者注，wkwebview设置cookie的参考"}]},{type:a,value:h},{type:b,tag:F,props:{className:[G]},children:[{type:b,tag:H,props:{className:[I,bY]},children:[{type:b,tag:x,props:{},children:[{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:"import"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"WebKit"}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:"extension"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"BxWebViewController"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aq}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:"setWkCookieAndPush"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:Z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:am},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,ae]},children:[{type:a,value:"\u002F\u002F 删除旧Cookie"}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:_}]},{type:a,value:" cookies "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:bh}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bi},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"cookies\n        "},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:cT}]},{type:a,value:" delCookie "},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:cU}]},{type:a,value:" cookies"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:az}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:bh}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bi},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:"deleteCookie"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"delCookie"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Y}]},{type:a,value:" #"},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:cV}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:cW},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:cX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:cY}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:Z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:am},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:am},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:_}]},{type:a,value:b$},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:bd}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:cZ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:aX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:am},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:bc}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:aC},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aO}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,ae]},children:[{type:a,value:"\u002F\u002F 2. iOS11以下"}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:_}]},{type:a,value:" cookieString "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:c_}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:Z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:_}]},{type:a,value:" mutiRequest "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:aN}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:cZ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:aX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:am},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:"\n            mutiRequest"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:"addValue"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:c$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:Z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:" forHTTPHeaderField"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:a$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:_}]},{type:a,value:" cookiScript "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:aZ}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"source"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:" cookieString"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:bW},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"WKUserScriptInjectionTime"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"atDocumentStart"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:bX},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,bb]},children:[{type:a,value:cg}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:da},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"userContentController"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:"addUserScript"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"cookiScript"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aR}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:bc}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"mutiRequest "},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ax}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:bd}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:aP},{type:b,tag:c,props:{className:[d,ae]},children:[{type:a,value:"\u002F\u002F 1. 测试301没有问题"}]},{type:a,value:aP},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aq}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:c_}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aR}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aw}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aa}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aj}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"\"document.cookie = 'access_token="},{type:b,tag:c,props:{className:[d,an]},children:[{type:b,tag:c,props:{className:[d,R,L]},children:[{type:a,value:ao}]},{type:a,value:Z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ba}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,R,L]},children:[{type:a,value:i}]}]},{type:a,value:"; path=\u002F'; document.cookie = 'grayFlag = "},{type:b,tag:c,props:{className:[d,an]},children:[{type:b,tag:c,props:{className:[d,R,L]},children:[{type:a,value:ao}]},{type:a,value:Z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:db}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:dc}]},{type:b,tag:c,props:{className:[d,R,L]},children:[{type:a,value:i}]}]},{type:a,value:"; path=\u002F'; document.cookie='public_no_code="},{type:b,tag:c,props:{className:[d,an]},children:[{type:b,tag:c,props:{className:[d,R,L]},children:[{type:a,value:ao}]},{type:a,value:Z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:dd}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,R,L]},children:[{type:a,value:i}]}]},{type:a,value:";path=\u002F'; document.cookie ='requestType="},{type:b,tag:c,props:{className:[d,an]},children:[{type:b,tag:c,props:{className:[d,R,L]},children:[{type:a,value:ao}]},{type:a,value:Z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:de}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:df}]},{type:b,tag:c,props:{className:[d,R,L]},children:[{type:a,value:i}]}]},{type:a,value:"; path=\u002F'\""}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:aP},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:"private"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aq}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:c$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:aR}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:P}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:aw}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aa}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aj}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"\"access_token="},{type:b,tag:c,props:{className:[d,an]},children:[{type:b,tag:c,props:{className:[d,R,L]},children:[{type:a,value:ao}]},{type:a,value:Z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ba}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,R,L]},children:[{type:a,value:i}]}]},{type:a,value:"; grayFlag="},{type:b,tag:c,props:{className:[d,an]},children:[{type:b,tag:c,props:{className:[d,R,L]},children:[{type:a,value:ao}]},{type:a,value:Z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:db}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:dc}]},{type:b,tag:c,props:{className:[d,R,L]},children:[{type:a,value:i}]}]},{type:a,value:"; public_no_code="},{type:b,tag:c,props:{className:[d,an]},children:[{type:b,tag:c,props:{className:[d,R,L]},children:[{type:a,value:ao}]},{type:a,value:Z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:dd}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:ay}]},{type:b,tag:c,props:{className:[d,R,L]},children:[{type:a,value:i}]}]},{type:a,value:"; requestType="},{type:b,tag:c,props:{className:[d,an]},children:[{type:b,tag:c,props:{className:[d,R,L]},children:[{type:a,value:ao}]},{type:a,value:Z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:de}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:df}]},{type:b,tag:c,props:{className:[d,R,L]},children:[{type:a,value:i}]}]},{type:a,value:"\""}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:"\n\n    @"},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:cV}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:cW},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:cX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aq}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:cY}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:Z},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:am},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:aa}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:cT}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"key"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:C}]},{type:a,value:cf},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:cU}]},{type:a,value:" cookieDic "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:b_}]},{type:a,value:dg},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:"Any"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bO},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:" key\n            propertiesDic"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bP},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:" value\n            propertiesDic"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bQ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:aX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:am},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:E}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"host"},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:az}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"path"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"\"\u002F\""}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bS},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:"Date"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"timeIntervalSinceNow"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:dh}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:dh}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"24"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:B}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,A]},children:[{type:a,value:"7"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"version"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,w]},children:[{type:a,value:"\"0\""}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:ap}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"originURL"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:r}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:aX}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:w},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:am},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:_}]},{type:a,value:di},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:"HTTPCookie"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"properties"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:dg},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Y}]},{type:a,value:di},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:"!="}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,aY]},children:[{type:a,value:cQ}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:a,value:aQ},{type:b,tag:c,props:{className:[d,p]},children:[{type:a,value:bh}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:bi},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:dj}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:dk},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:aQ},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:_}]},{type:a,value:" httpCookieStore "},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ab}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:ak},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:da},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"websiteDataStore"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"httpCookieStore\n                httpCookieStore"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:b,tag:c,props:{className:[d,o]},children:[{type:a,value:dj}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:dk},{type:b,tag:c,props:{className:[d,g]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:i}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:t}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:J},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:D},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:af},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:h},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:u}]},{type:a,value:h}]}]}]}]},dir:"\u002Fwiki\u002FiOS-G2",path:dl,extension:".md",createdAt:dm,updatedAt:dm},prev:{slug:"Spring-springboot-schedule",title:"spring框中简单的任务调度",date:"2019-09-25T00:00:00.000Z"},next:{slug:"杂记-hugo中使用思维导图",title:"hugo中使用思维导图",date:"2020-05-09T00:00:00.000Z"},scrollTop:dn,sideCategory:[{folderName:"iOS-G2",articles:[{slug:"appclip-preview-1",date:"2020-10-13 09:17:29 +8000",title:"App Clips 简介",path:"\u002Fwiki\u002FiOS-G2\u002Fappclip-preview-1"},{slug:"iOS-G2-(译)wkwebview一些tips",title:"(译)wkwebview一些tips",date:"2020-06-16T00:00:00.000Z",path:"\u002Fwiki\u002FiOS-G2\u002FiOS-G2-(译)wkwebview一些tips"},{slug:"iOS-G2-telegram-iOS源码分析-1",title:"telegram-iOS源码分析-启动",date:"2020-04-23T00:00:00.000Z",path:"\u002Fwiki\u002FiOS-G2\u002FiOS-G2-telegram-iOS源码分析-1"},{slug:bl,title:bm,date:aJ,path:dl}],children:[{folderName:"AppClip",articles:[{slug:"AppClip-AppClip-note1",title:"AppClip笔记（一）",date:"2020-09-30T00:00:00.000Z",path:"\u002Fwiki\u002FiOS-G2\u002FAppClip\u002FAppClip-AppClip-note1"},{slug:"AppClip-一些关于AppClips的笔记",date:"2020-10-26T08:10:45.000Z",title:"一些关于AppClips的笔记(转载)",path:"\u002Fwiki\u002FiOS-G2\u002FAppClip\u002FAppClip-一些关于AppClips的笔记"}],children:[]},{folderName:"Debug",articles:[{slug:"Debug-DEBUG环境变量以及环境状态区分",title:"DEBUG环境变量以及环境状态区分",date:bk,path:"\u002Fwiki\u002FiOS-G2\u002FDebug\u002FDebug-DEBUG环境变量以及环境状态区分"},{slug:"Debug-swift-test",title:"单元测试和UI测试",date:bk,path:"\u002Fwiki\u002FiOS-G2\u002FDebug\u002FDebug-swift-test"}],children:[]},{folderName:"GCD",articles:[{slug:"GCD-(转)信号量",title:"(转)GCD信号量",date:"2020-05-18T00:00:00.000Z",path:"\u002Fwiki\u002FiOS-G2\u002FGCD\u002FGCD-(转)信号量"}],children:[]},{folderName:"Mass",articles:[{slug:"Mass-ms-IQKeyboard-dissmiss-black",title:"IQKeyboard dissmiss黑边问题",date:aJ,path:"\u002Fwiki\u002FiOS-G2\u002FMass\u002FMass-ms-IQKeyboard-dissmiss-black"},{slug:"Mass-ms-URLProtocolDemo",title:"WkWebview+URLProtocol",date:aJ,path:"\u002Fwiki\u002FiOS-G2\u002FMass\u002FMass-ms-URLProtocolDemo"},{slug:"Mass-ms-env",title:"sandboxReceipt",date:"2020-05-06T00:00:00.000Z",path:"\u002Fwiki\u002FiOS-G2\u002FMass\u002FMass-ms-env"},{slug:"Mass-swift-url-encoding",title:"swift url编码问题（CharacterSet使用）",date:"2020-05-25T00:00:00.000Z",path:"\u002Fwiki\u002FiOS-G2\u002FMass\u002FMass-swift-url-encoding"},{slug:"Mass-work-issue",title:"mess issue",date:"2020-05-07T00:00:00.000Z",path:"\u002Fwiki\u002FiOS-G2\u002FMass\u002FMass-work-issue"}],children:[]},{folderName:"UICollectionView",articles:[{slug:"UICollectionView-UICollectionView自适应高度",date:"2020-10-23T05:31:37.000Z",title:"UICollectionView自适应高度(autolayout)",path:"\u002Fwiki\u002FiOS-G2\u002FUICollectionView\u002FUICollectionView-UICollectionView自适应高度"}],children:[]},{folderName:cq,articles:[{slug:"UIView-uiview-shadow",title:"UIView圆角阴影",date:bk,path:"\u002Fwiki\u002FiOS-G2\u002FUIView\u002FUIView-uiview-shadow"}],children:[]}]}]}],fetch:{},mutations:dn}}("text","element","span","token","punctuation"," ","operator","\n",")",":","(","keyword",".","p","function","builtin","[","]","=","{","}","class-name","string","code",";","a","number","*",",","\n        ","?","div","nuxt-content-highlight","pre","line-numbers","\n            ","true","variable",-1,"icon","icon-link","-"," \n    ","delimiter","maybe-class-name"," \n","nofollow","noopener","noreferrer","_blank","if","cookieDic","let","void","String","self",2,"h2","comment","\n    ","completionHandler","^","strong","return","webView","language-java"," url","interpolation","\\(","HTTPCookiePropertyKey","func"," \n        ",3,"h3","li","language-js","\u003E","as","\"\"","!","language-text","property-access","request","NSURLRequest"," webView","+","NSString","@","\n            propertiesDic","2020-05-03T00:00:00.000Z","导语","8、其它问题","9、结语","NSMutableURLRequest","else","\n\n    ","\n                ","_","WKWebView","0","frame","UIAlertController","UIAlertAction","URL","constant","WKUserScript"," request","\"Cookie\"","\"access_token\"","boolean","load","URLRequest","size","annotation","completionHandler \n","HTTPCookieStorage","shared"," cookieDic","2020-08-14T00:00:00.000Z","iOS-G2-(转)WKWebView 那些坑","(转)bugly WKWebView 那些坑","1、wkwebview-白屏问题","1、WKWebView 白屏问题","2、wkwebview-cookie-问题","2、WKWebView Cookie 问题","21、wkwebview-cookie存储","2.1、WKWebView Cookie存储","22、wkprocesspool","2.2、WKProcessPool","23、workaround","2.3、Workaround","3、wkwebview-nsurlprotocol问题","3、WKWebView NSURLProtocol问题","4、wkwebview-loadrequest-问题","4、WKWebView loadRequest 问题","5、wkwebview-页面样式问题","5、WKWebView 页面样式问题","6-wkwebview-截屏问题","6. WKWebView 截屏问题","7wkwebview-crash问题","7.WKWebView crash问题","81、视频自动播放","8.1、视频自动播放","82、goback-api问题","8.2、goBack API问题","83、页面滚动速率","8.3、页面滚动速率","http:\u002F\u002Fpeople.mozilla.org\u002F~rnewman\u002Ffennec\u002Fmem.html","name","value","domain","y","expires","http:\u002F\u002Fy.qq.com%EF%BC%8C","http:\u002F\u002Fy.qq.com，","WKUserContentController"," injectionTime"," forMainFrameOnly","language-swift","requestAddCookie","var"," request "," fixeReq ","hasAppCookie","allHTTPHeaderFields","contains","\n                    "," value","false"," navigationAction","request ","decisionHandler","https:\u002F\u002Fbugs.webkit.org\u002Fshow_bug.cgi?id=138169","http:\u002F\u002Fh5.qzone.qq.com\u002Fmqzone\u002Findex","post:\u002F\u002Fh5.qzone.qq.com\u002Fmqzone\u002Findex"," \nwebView","origin","height ","UIView","UIImage","YES","main","nonnull ","nullable ","webView runJavaScriptAlertPanelWithMessage","message initiatedByFrame","WKFrameInfo","frame completionHandler","alertController "," alertControllerWithTitle"," message","message preferredStyle","UIAlertControllerStyleAlert","alertController addAction"," actionWithTitle","\"确认\""," style","UIAlertActionStyleCancel"," handler","action","self presentViewController","alertController animated","YES completion","altEvaluateJavaScript","nil","javaScriptString completionHandler","NSError","for","in","available","iOS ","11.0","setCookies","url","generateCookieInject","generateCookieKeyValue","configuration","\"grayFlag\"","\"false\"","\"public_no_code\"","\"requestType\"","\"native\""," propertiesDic","60"," newCookie ","setCookie","newCookie","\u002Fwiki\u002FiOS-G2\u002FiOS-G2-(转)WKWebView 那些坑","2021-09-15T01:49:08.567Z",void 0)));
__NUXT_JSONP__("/wiki/content/GCD-(%E8%BD%AC)%E4%BF%A1%E5%8F%B7%E9%87%8F", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a_,a$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS){return {data:[{},{article:{slug:aQ,title:aR,layout:"page",date:aS,collection:aT,toc:[{id:ac,depth:ad,text:ac},{id:ae,depth:ad,text:ae},{id:af,depth:ad,text:af},{id:y,depth:ag,text:y},{id:I,depth:ag,text:I},{id:ah,depth:ag,text:ah},{id:K,depth:ag,text:K},{id:ai,depth:ad,text:ai}],body:{type:"root",children:[{type:b,tag:t,props:{},children:[{type:a,value:"本文为转载,"},{type:b,tag:L,props:{href:"https:\u002F\u002Fxiaozhuanlan.com\u002Ftopic\u002F4365017982",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:a,value:"原文地址"}]},{type:a,value:H}]},{type:a,value:i},{type:b,tag:aj,props:{id:ac},children:[{type:b,tag:L,props:{href:"#%E6%A6%82%E8%BF%B0",ariaHidden:R,tabIndex:S},children:[{type:b,tag:c,props:{className:[T,U]},children:[]}]},{type:a,value:ac}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"Dispatch Semaphore是持有计数的信号，该信号是多线程编程中的计数类型信号。信号类似于过马路时的手旗，可以通过时举起手旗，不可通过时放下手旗。而在Dispatch Semaphore中使用了计数来实现该功能。计数为0时等待，计数为1或者大于1时放行。"}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"信号量的使用比较简单，主要就三个API："},{type:b,tag:w,props:{},children:[{type:a,value:"create"}]},{type:a,value:"、"},{type:b,tag:w,props:{},children:[{type:a,value:"wait"}]},{type:a,value:"和"},{type:b,tag:w,props:{},children:[{type:a,value:"signal"}]},{type:a,value:"。"}]},{type:a,value:i},{type:b,tag:aj,props:{id:ae},children:[{type:b,tag:L,props:{href:"#%E4%BD%BF%E7%94%A8%E7%AF%87",ariaHidden:R,tabIndex:S},children:[{type:b,tag:c,props:{className:[T,U]},children:[]}]},{type:a,value:ae}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:b,tag:w,props:{},children:[{type:a,value:I}]},{type:a,value:"可以生成信号量，参数value是信号量计数的初始值；"},{type:b,tag:ay,props:{},children:[]},{type:a,value:i},{type:b,tag:w,props:{},children:[{type:a,value:K}]},{type:a,value:"会让信号量值减一，当信号量值为0时会等待(直到超时)，否则正常执行；"},{type:b,tag:ay,props:{},children:[]},{type:a,value:i},{type:b,tag:w,props:{},children:[{type:a,value:ak}]},{type:a,value:"会让信号量值加一，如果有通过dispatch_semaphore_wait函数等待Dispatch Semaphore的计数值增加的线程，会由系统唤醒最先等待的线程执行。"}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"接下来具体看一下信号量的用法："},{type:b,tag:ay,props:{},children:[]},{type:a,value:"\n1、信号量常用于对资源进行加锁操作，防止多线程访问修改数据出现结果不一致甚至崩溃的问题，代码示例如下:"}]},{type:a,value:i},{type:b,tag:A,props:{className:[B]},children:[{type:b,tag:C,props:{className:[D,M]},children:[{type:b,tag:w,props:{},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F信号量常用于对资源进行加锁操作，防止多线程访问修改数据出现结果不一致甚至崩溃的问题，代码示例如下:"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F创建信号量,初始值为1 (\u003E=1为放行)"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:y}]},{type:a,value:" _lock "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002Fwait使信号量减1,此时信号量=0,则进行等待"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:K}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:al},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F修改Array或字典等数据的信息"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:am}]},{type:a,value:"m addObject"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:N}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ao}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F信号量加1,放行"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:ak}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aU},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:i}]}]}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"2、信号量也可用于链式请求，比如用来限制请求频次："}]},{type:a,value:i},{type:b,tag:A,props:{className:[B]},children:[{type:b,tag:C,props:{className:[D,M]},children:[{type:b,tag:w,props:{},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F链式请求，限制网络请求串行执行，第一个请求成功后再开始第二个请求"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:_}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:"chainRequestCurrentConfig "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aV}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aW},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:"\n        NSArray "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:Y}]},{type:a,value:"list "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:" @"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:am}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,Z]},children:[{type:a,value:"\"1\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,Z]},children:[{type:a,value:"\"2\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:an},{type:b,tag:c,props:{className:[d,Z]},children:[{type:a,value:"\"3\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ao}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:y}]},{type:a,value:" semaphore "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:am}]},{type:a,value:"list enumerateObjectsUsingBlock"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"id  _Nonnull obj"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" NSUInteger idx"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" BOOL "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:Y}]},{type:a,value:" _Nonnull stop"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:am}]},{type:a,value:"self fetchConfigurationWithCompletion"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aX},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:Y}]},{type:a,value:aY},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:ak}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ao}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:K}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:al},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:ao}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:_}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:"fetchConfigurationWithCompletion"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:N}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:X}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aX},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:Y}]},{type:a,value:aY},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:aZ},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002FAFNetworking或其他网络请求库"}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aV}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aW},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:$}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F模拟网络请求"}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"sleep"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:"2"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:"!"}]},{type:a,value:aZ},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:"?"}]},{type:a,value:" nil "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:N}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"completion"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"nil"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:i}]}]}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"以上是信号量的简单用法，接下来看一下Dispatch Semaphore的原理和实现。"}]},{type:a,value:i},{type:b,tag:aj,props:{id:af},children:[{type:b,tag:L,props:{href:"#%E5%8E%9F%E7%90%86%E7%AF%87",ariaHidden:R,tabIndex:S},children:[{type:b,tag:c,props:{className:[T,U]},children:[]}]},{type:a,value:af}]},{type:a,value:i},{type:b,tag:ap,props:{id:y},children:[{type:b,tag:L,props:{href:"#dispatch_semaphore_t",ariaHidden:R,tabIndex:S},children:[{type:b,tag:c,props:{className:[T,U]},children:[]}]},{type:a,value:y}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"首先看一下"},{type:b,tag:w,props:{},children:[{type:a,value:aB}]},{type:a,value:"的结构体定义："}]},{type:a,value:i},{type:b,tag:A,props:{className:[B]},children:[{type:b,tag:C,props:{className:[D,M]},children:[{type:b,tag:w,props:{},children:[{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aq}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aB}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"DISPATCH_STRUCT_HEADER"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"semaphore_t"}]},{type:a,value:" dsema_port"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"    "},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F等同于mach_port_t信号"}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:J}]},{type:a,value:" dsema_orig"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"           "},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F初始化的信号量值"}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:J}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ab}]},{type:a,value:aC},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F当前信号量值"}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:"union"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:J}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ab}]},{type:a,value:a_},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:J}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ab}]},{type:a,value:" dsema_group_waiters"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aq}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:a$}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ab}]},{type:a,value:" dsema_notify_head"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002Fnotify的链表头部"}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aq}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:a$}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:Y}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:ab}]},{type:a,value:" dsema_notify_tail"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002Fnotify的链表尾部"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:i}]}]}]},{type:a,value:i},{type:b,tag:ap,props:{id:I},children:[{type:b,tag:L,props:{href:"#dispatch_semaphore_create",ariaHidden:R,tabIndex:S},children:[{type:b,tag:c,props:{className:[T,U]},children:[]}]},{type:a,value:I}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"dispatch_semaphore_create用来创建信号量，创建时需要指定value，内部会将value的值存储到dsema_value(当前的value)和dsema_orig(初始value)中，value的值必须大于或等于0。"}]},{type:a,value:i},{type:b,tag:A,props:{className:[B]},children:[{type:b,tag:C,props:{className:[D,M]},children:[{type:b,tag:w,props:{},children:[{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:y}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:J}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:y}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aD}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:ba},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002Fvalue值需大于或等于0"}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,"constant"]},children:[{type:a,value:"NULL"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:"\n  "},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F申请dispatch_semaphore_t的内存"}]},{type:a,value:"\n    dsema "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"_dispatch_alloc"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"DISPATCH_VTABLE"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aq}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:aB}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:_}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:z}]},{type:a,value:"dsema_notify_head"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:_}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aE}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:z}]},{type:a,value:"dsema_notify_tail"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F调用初始化函数"}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bb}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"value"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Q}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F初始化结构体信息"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:bc}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:X}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bb}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:J}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:bd}]},{type:a,value:at},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:y}]},{type:a,value:be},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:at},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:a,value:bf},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:au},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:z}]},{type:a,value:"do_next "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:y}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:"DISPATCH_OBJECT_LISTLESS"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:au},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:z}]},{type:a,value:"do_targetq "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:az}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"\n            DISPATCH_QUEUE_PRIORITY_DEFAULT"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:au},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:z}]},{type:a,value:bg},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F设置信号量的当前value值"}]},{type:a,value:au},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:z}]},{type:a,value:"dsema_orig "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:ar},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:bh},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F设置信号量的初始value值"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:i}]}]}]},{type:a,value:i},{type:b,tag:ap,props:{id:ah},children:[{type:b,tag:L,props:{href:"#%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E9%87%8A%E6%94%BE",ariaHidden:R,tabIndex:S},children:[{type:b,tag:c,props:{className:[T,U]},children:[]}]},{type:a,value:ah}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"接着来看Dispatch Semaphore很容易忽略也是最容易造成App崩溃的地方，即信号量的释放。"}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"创建Semaphore的时候会将do_vtable指向_dispatch_semaphore_vtable，_dispatch_semaphore_vtable的结构定义了信号量销毁的时候会执行"},{type:b,tag:w,props:{},children:[{type:a,value:bi}]},{type:a,value:"方法，相关代码实现如下"}]},{type:a,value:i},{type:b,tag:A,props:{className:[B]},children:[{type:b,tag:C,props:{className:[D,M]},children:[{type:b,tag:w,props:{},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002Fsemaphore的vtable定义"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"DISPATCH_VTABLE_INSTANCE"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aa},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:a,value:"do_type "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:" DISPATCH_SEMAPHORE_TYPE"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:a,value:"do_kind "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,Z]},children:[{type:a,value:"\"semaphore\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:a,value:"do_dispose "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:" _dispatch_semaphore_dispose"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:bh},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F销毁时执行的回调函数"}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:a,value:"do_debug "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:" _dispatch_semaphore_debug"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"      "},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002Fdebug函数"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:i}]}]}]},{type:a,value:i},{type:b,tag:A,props:{className:[B]},children:[{type:b,tag:C,props:{className:[D,M]},children:[{type:b,tag:w,props:{},children:[{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F释放信号量的函数"}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:X}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bi}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:bd}]},{type:a,value:at},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:y}]},{type:a,value:be},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:at},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:a,value:bf},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:z}]},{type:a,value:bg},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aD}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:z}]},{type:a,value:"dsema_orig"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:ba},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002FWarning:信号量还在使用的时候销毁会造成崩溃"}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"DISPATCH_CLIENT_CRASH"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,Z]},children:[{type:a,value:"\"Semaphore\u002Fgroup object deallocated while in use\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:bk}]},{type:a,value:bl},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:z}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:"\n        kr "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"semaphore_destroy"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"mach_task_self"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:z}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:i}]}]}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"如果销毁时信号量还在使用，那么dsema_value会小于dsema_orig，则会引起崩溃，这是一个特别需要注意的地方。这里模拟一下信号量崩溃的代码:"}]},{type:a,value:i},{type:b,tag:A,props:{className:[B]},children:[{type:b,tag:C,props:{className:[D,M]},children:[{type:b,tag:w,props:{},children:[{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:y}]},{type:a,value:" semephore "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:K}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"semephore"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:al},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,u]},children:[{type:a,value:"\u002F\u002F重新赋值或者将semephore = nil都会造成崩溃,因为此时信号量还在使用中"}]},{type:a,value:"\nsemephore "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:I}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:i}]}]}]},{type:a,value:i},{type:b,tag:ap,props:{id:K},children:[{type:b,tag:L,props:{href:"#dispatch_semaphore_wait",ariaHidden:R,tabIndex:S},children:[{type:b,tag:c,props:{className:[T,U]},children:[]}]},{type:a,value:K}]},{type:a,value:i},{type:b,tag:A,props:{className:[B]},children:[{type:b,tag:C,props:{className:[D,M]},children:[{type:b,tag:w,props:{},children:[{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:J}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:K}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:y}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:bm}]},{type:a,value:aG},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:J}]},{type:a,value:" value "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"dispatch_atomic_dec2o"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:aC},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" acquire"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bn}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:"\u003E="}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bo}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:aG},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:i}]}]}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"dispatch_semaphore_wait先将信号量的dsema值原子性减一，并将新值赋给value。如果value大于等于0就立即返回，否则调用_dispatch_semaphore_wait_slow函数，等待信号量唤醒或者timeout超时。_dispatch_semaphore_wait_slow函数定义如下："}]},{type:a,value:i},{type:b,tag:A,props:{className:[B]},children:[{type:b,tag:C,props:{className:[D,M]},children:[{type:b,tag:w,props:{},children:[{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:bc}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:J}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bo}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:y}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:bm}]},{type:a,value:aG},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:J}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"mach_timespec_t"}]},{type:a,value:bp},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:bk}]},{type:a,value:bl},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"\nagain"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:N}]},{type:a,value:"\n    orig "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:z}]},{type:a,value:"dsema_sent_ksignals"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aw}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:a_},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n                orig "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:_}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:ax}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:br},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:bj},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"_dispatch_semaphore_create_port"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:ax}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:z}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:"switch"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:bs},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:"default"}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:N}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:bt}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,r]},children:[{type:a,value:"uint64_t"}]},{type:a,value:" nsec "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"_dispatch_timeout"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:bs},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:bu},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:a,value:"tv_sec "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:bv}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:bw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:a,value:"tv_sec"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:bx},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:"\u002F"}]},{type:a,value:by},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:bu},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:a,value:"tv_nsec "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:bv}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:bw},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:H}]},{type:a,value:"tv_nsec"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:bx},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:"%"}]},{type:a,value:by},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:bz},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bA}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"semaphore_timedwait"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:z}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:bp},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aw}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aJ},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aK}]},{type:a,value:bB},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"\n\n        "},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aJ},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:"!="}]},{type:a,value:bC},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:bD}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:bE}]},{type:a,value:" DISPATCH_TIME_NOW"},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:N}]},{type:a,value:"\n        orig "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:O},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:z}]},{type:a,value:"dsema_value"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aw}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"orig "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aD}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:bq}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:aC},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:" orig "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:"+"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:"\n                    "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:ax}]},{type:a,value:aI},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:o}]},{type:a,value:br},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:aA},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:Q}]},{type:a,value:bC},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:G},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:bE}]},{type:a,value:al},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:N}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:bt}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:bz},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:"semaphore_wait"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:z}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:aw}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:aJ},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aK}]},{type:a,value:bB},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,n]},children:[{type:a,value:aF}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:bD}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:"goto"}]},{type:a,value:" again"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:i}]}]}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"_dispatch_semaphore_wait_slow函数根据timeout的类型分成了三种情况处理："}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"1、DISPATCH_TIME_NOW：若desma_value小于0，对其加一并返回超时信号KERN_OPERATION_TIMED_OUT，原子性加一是为了抵消dispatch_semaphore_wait函数开始的减一操作。\n2、DISPATCH_TIME_FOREVER：调用系统的semaphore_wait方法，直到收到signal调用。"}]},{type:a,value:i},{type:b,tag:A,props:{className:[B]},children:[{type:b,tag:C,props:{className:[D,aL]},children:[{type:b,tag:w,props:{},children:[{type:a,value:"kr = semaphore_wait(dsema-\u003Edsema_port);\n"}]}]}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"3、default：调用内核方法semaphore_timedwait计时等待，直到有信号到来或者超时了。"}]},{type:a,value:i},{type:b,tag:A,props:{className:[B]},children:[{type:b,tag:C,props:{className:[D,aL]},children:[{type:b,tag:w,props:{},children:[{type:a,value:"kr = slowpath(semaphore_timedwait(dsema-\u003Edsema_port, _timeout));\n"}]}]}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"dispatch_semaphore_wait的流程图可以用下图表示："}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:b,tag:bF,props:{alt:"20200518158978945390099.png",src:"https:\u002F\u002Fcdn.jsdelivr.net\u002Fgh\u002Fquicktouch\u002Fimage@main\u002Fimg\u002F20200518158978945390099.png"},children:[]}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:ak}]},{type:a,value:i},{type:b,tag:A,props:{className:[B]},children:[{type:b,tag:C,props:{className:[D,bG]},children:[{type:b,tag:w,props:{},children:[{type:a,value:"long dispatch_semaphore_signal"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:bH},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:"\n    long value "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:" dispatch_atomic_inc2o"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"dsema, dsema_value, release"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:bn},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aM}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:bI}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:v},{type:b,tag:c,props:{className:[d,aN,r]},children:[{type:a,value:Q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:F}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:P}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:bA},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:as},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aK}]},{type:a,value:" LONG_MIN"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:bI}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:"\n       \u002F\u002FWarning：value值有误会造成崩溃，详见下篇dispatch_group的分析\n        DISPATCH_CLIENT_CRASH"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,Z]},children:[{type:a,value:"\"Unbalanced call to dispatch_semaphore_signal()\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,aN,r]},children:[{type:a,value:Q}]},{type:a,value:" _dispatch_semaphore_signal_slow"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:i}]}]}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"首先将dsema_value调用原子方法加1，如果大于零就立即返回0，否则进入_dispatch_semaphore_signal_slow方法，该函数会调用内核的semaphore_signal函数唤醒在dispatch_semaphore_wait中等待的线程。代码如下"}]},{type:a,value:i},{type:b,tag:A,props:{className:[B]},children:[{type:b,tag:C,props:{className:[D,bG]},children:[{type:b,tag:w,props:{},children:[{type:a,value:"long _dispatch_semaphore_signal_slow"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:bH},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:p}]},{type:a,value:"\n    _dispatch_retain"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:a,value:"dispatch_atomic_inc2o"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"dsema, dsema_sent_ksignals, relaxed"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"\n    _dispatch_semaphore_create_port"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:ax}]},{type:a,value:bJ},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aM}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"\n    kern_return_t kr "},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:s}]},{type:a,value:" semaphore_signal"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:bJ},{type:b,tag:c,props:{className:[d,h]},children:[{type:a,value:aM}]},{type:a,value:V},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"\n    DISPATCH_SEMAPHORE_VERIFY_KR"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:av},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:"\n\n    _dispatch_release"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:E},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:m},{type:b,tag:c,props:{className:[d,aN,r]},children:[{type:a,value:Q}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,x]},children:[{type:a,value:W}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:k}]},{type:a,value:i},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:q}]},{type:a,value:i}]}]}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"dispatch_semaphore_signal的流程比较简单，可以用下图表示："}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:b,tag:bF,props:{alt:"20200518158978951621656.png",src:"https:\u002F\u002Fcdn.jsdelivr.net\u002Fgh\u002Fquicktouch\u002Fimage@main\u002Fimg\u002F20200518158978951621656.png"},children:[]}]},{type:a,value:i},{type:b,tag:aj,props:{id:ai},children:[{type:b,tag:L,props:{href:"#%E6%80%BB%E7%BB%93%E7%AF%87",ariaHidden:R,tabIndex:S},children:[{type:b,tag:c,props:{className:[T,U]},children:[]}]},{type:a,value:ai}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"Dispatch Semaphore信号量主要是dispatch_semaphore_wait和dispatch_semaphore_signal函数，wait会将信号量值减一，如果大于等于0就立即返回，否则等待信号量唤醒或者超时；signal会将信号量值加一，如果value大于0立即返回，否则唤醒某个等待中的线程。"}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"需要注意的是信号量在销毁或重新创建的时候如果还在使用则会引起崩溃，详见上面的分析。"}]},{type:a,value:i},{type:b,tag:t,props:{},children:[{type:a,value:"简单的代码示例"}]},{type:a,value:i},{type:b,tag:A,props:{className:[B]},children:[{type:b,tag:C,props:{className:[D,aL]},children:[{type:b,tag:w,props:{},children:[{type:a,value:"#import \"ViewController.h\"\n\n@interface ViewController ()\n \n@end\n\n@implementation ViewController\n\n\u002F**\nDispatch Semaphore是持有计数的信号，该信号是多线程编程中的计数类型信号。\n信号类似于过马路时的手旗，可以通过时举起手旗，不可通过时放下手旗。而在Dispatch Semaphore中使用了计数来实现该功能。\n计数为0时等待，计数为1或者大于1时放行。\n 信号量的使用比较简单，主要就三个API：create、wait和signal。\n\ndispatch_semaphore_create可以生成信号量，参数value是信号量计数的初始值；\n dispatch_semaphore_wait会让信号量值减一，当信号量值为0时会等待(直到超时)，否则正常执行；\n dispatch_semaphore_signal会让信号量值加一，如果有通过dispatch_semaphore_wait函数等待Dispatch Semaphore的计数值增加的线程，会由系统唤醒最先等待的线程执行。\n \n \n*\u002F\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n    \u002F\u002F Do any additional setup after loading the view.\n}\n\n- (void)touchesBegan:(NSSet\u003CUITouch *\u003E *)touches withEvent:(UIEvent *)event{\n    [self chainRequestCurrentConfig];\n}\n\n- (void)lockResource{\n    NSMutableArray *m = [NSMutableArray array];\n    \u002F\u002F信号量常用于对资源进行加锁操作，防止多线程访问修改数据出现结果不一致甚至崩溃的问题，代码示例如下:\n    \u002F\u002F创建信号量,初始值为1 (\u003E=1为放行)\n    dispatch_semaphore_t _lock = dispatch_semaphore_create(1);\n    \u002F\u002Fwait使信号量减1,此时信号量=0,则进行等待\n    dispatch_semaphore_wait(_lock, DISPATCH_TIME_FOREVER);\n    \u002F\u002F修改Array或字典等数据的信息\n    [m addObject:@1];\n    \u002F\u002F信号量加1,放行\n    dispatch_semaphore_signal(_lock);\n    NSLog(@\"%@\",m);\n}\n\n- (void)chainRequestCurrentConfig{\n    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{\n        NSArray *list = @[@\"1\",@\"2\",@\"3\"];\n        \u002F\u002F默认阻塞\n        dispatch_semaphore_t semaphore = dispatch_semaphore_create(0);\n        [list enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {\n            [self fetchConfigurationWithCompletion:^(NSDictionary *dict) {\n                NSLog(@\"%@\",obj);\n                dispatch_semaphore_signal(semaphore);\n            }];\n        }];\n    });\n}\n\n- (void)fetchConfigurationWithCompletion:(void(^)(NSDictionary* dict))completion{\n    \u002F\u002FAFN或者其他网络请求库\n    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{\n        sleep(2);\n        !completion ? nil : completion(nil);\n    });\n}\n@end\n"}]}]}]}]},dir:"\u002Fwiki\u002FiOS-G2\u002FGCD",path:bK,extension:".md",createdAt:bL,updatedAt:bL},prev:{slug:bM,title:bN,date:bO},next:{slug:bP,title:bQ,date:bR},scrollTop:bS,sideCategory:[{folderName:"iOS-G2",articles:[{slug:"appclip-preview-1",date:"2020-10-13 09:17:29 +8000",title:"App Clips 简介",path:"\u002Fwiki\u002FiOS-G2\u002Fappclip-preview-1"},{slug:"iOS-G2-(译)wkwebview一些tips",title:"(译)wkwebview一些tips",date:"2020-06-16T00:00:00.000Z",path:"\u002Fwiki\u002FiOS-G2\u002FiOS-G2-(译)wkwebview一些tips"},{slug:"iOS-G2-telegram-iOS源码分析-1",title:"telegram-iOS源码分析-启动",date:"2020-04-23T00:00:00.000Z",path:"\u002Fwiki\u002FiOS-G2\u002FiOS-G2-telegram-iOS源码分析-1"},{slug:"iOS-G2-(转)WKWebView 那些坑",title:"(转)bugly WKWebView 那些坑",date:aO,path:"\u002Fwiki\u002FiOS-G2\u002FiOS-G2-(转)WKWebView 那些坑"}],children:[{folderName:"AppClip",articles:[{slug:"AppClip-AppClip-note1",title:"AppClip笔记（一）",date:"2020-09-30T00:00:00.000Z",path:"\u002Fwiki\u002FiOS-G2\u002FAppClip\u002FAppClip-AppClip-note1"},{slug:"AppClip-一些关于AppClips的笔记",date:"2020-10-26T08:10:45.000Z",title:"一些关于AppClips的笔记(转载)",path:"\u002Fwiki\u002FiOS-G2\u002FAppClip\u002FAppClip-一些关于AppClips的笔记"}],children:[]},{folderName:"Debug",articles:[{slug:"Debug-DEBUG环境变量以及环境状态区分",title:"DEBUG环境变量以及环境状态区分",date:aP,path:"\u002Fwiki\u002FiOS-G2\u002FDebug\u002FDebug-DEBUG环境变量以及环境状态区分"},{slug:"Debug-swift-test",title:"单元测试和UI测试",date:aP,path:"\u002Fwiki\u002FiOS-G2\u002FDebug\u002FDebug-swift-test"}],children:[]},{folderName:aT,articles:[{slug:aQ,title:aR,date:aS,path:bK}],children:[]},{folderName:"Mass",articles:[{slug:"Mass-ms-IQKeyboard-dissmiss-black",title:"IQKeyboard dissmiss黑边问题",date:aO,path:"\u002Fwiki\u002FiOS-G2\u002FMass\u002FMass-ms-IQKeyboard-dissmiss-black"},{slug:"Mass-ms-URLProtocolDemo",title:"WkWebview+URLProtocol",date:aO,path:"\u002Fwiki\u002FiOS-G2\u002FMass\u002FMass-ms-URLProtocolDemo"},{slug:"Mass-ms-env",title:"sandboxReceipt",date:"2020-05-06T00:00:00.000Z",path:"\u002Fwiki\u002FiOS-G2\u002FMass\u002FMass-ms-env"},{slug:bP,title:bQ,date:bR,path:"\u002Fwiki\u002FiOS-G2\u002FMass\u002FMass-swift-url-encoding"},{slug:bM,title:bN,date:bO,path:"\u002Fwiki\u002FiOS-G2\u002FMass\u002FMass-work-issue"}],children:[]},{folderName:"UICollectionView",articles:[{slug:"UICollectionView-UICollectionView自适应高度",date:"2020-10-23T05:31:37.000Z",title:"UICollectionView自适应高度(autolayout)",path:"\u002Fwiki\u002FiOS-G2\u002FUICollectionView\u002FUICollectionView-UICollectionView自适应高度"}],children:[]},{folderName:"UIView",articles:[{slug:"UIView-uiview-shadow",title:"UIView圆角阴影",date:aP,path:"\u002Fwiki\u002FiOS-G2\u002FUIView\u002FUIView-uiview-shadow"}],children:[]}]}]}],fetch:{},mutations:bS}}("text","element","span","token","punctuation"," ","(","operator","\n",")",";","keyword","\n    ","function",",","{","}","class-name","=","p","comment","\n        ","code","number","dispatch_semaphore_t","-\u003E","div","nuxt-content-highlight","pre","line-numbers","dsema","0","\n            ",".","dispatch_semaphore_create","long","dispatch_semaphore_wait","a","language-c",":"," dsema","if","return","true",-1,"icon","icon-link","dsema_port","1","void","*","string","-","^","semaphore","volatile","概述",2,"使用篇","原理篇",3,"信号量的释放","总结篇","h2","dispatch_semaphore_signal"," DISPATCH_TIME_FOREVER","[","@","]","h3","struct"," value","value "," dou","\n    dsema","kr","while","&","br","dispatch_get_global_queue","\n                ","dispatch_semaphore_s"," dsema_value","\u003C","sizeof","DISPATCH_SEMAPHORE_VERIFY_KR"," timeout"," orig","orig","kr ","==","language-text","\u003E","builtin","2020-05-03T00:00:00.000Z","2020-08-14T00:00:00.000Z","GCD-(转)信号量","(转)GCD信号量","2020-05-18T00:00:00.000Z","GCD","_lock","dispatch_async","DISPATCH_QUEUE_PRIORITY_DEFAULT","NSDictionary ","dict","completion "," dsema_sent_ksignals","dispatch_continuation_s","\n       ","_dispatch_semaphore_init","static","dispatch_object_t"," dsema ","_dsema","dsema_value ","  ","_dispatch_semaphore_dispose","\n\n    ","kern_return_t"," kr","dispatch_time_t","fastpath","_dispatch_semaphore_wait_slow"," _timeout","dispatch_atomic_cmpxchgvw2o"," relaxed","timeout","do","\n            _timeout","typeof","_timeout","nsec "," NSEC_PER_SEC","\n            kr ","slowpath"," KERN_ABORTED"," KERN_OPERATION_TIMED_OUT","break","case","img","language-bash","dispatch_semaphore_t dsema","))","dsema-","\u002Fwiki\u002FiOS-G2\u002FGCD\u002FGCD-(转)信号量","2021-08-23T10:08:02.335Z","Mass-work-issue","mess issue","2020-05-07T00:00:00.000Z","Mass-swift-url-encoding","swift url编码问题（CharacterSet使用）","2020-05-25T00:00:00.000Z",void 0)));
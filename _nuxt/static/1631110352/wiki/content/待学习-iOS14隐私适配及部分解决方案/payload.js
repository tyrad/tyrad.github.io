__NUXT_JSONP__("/wiki/content/%E5%BE%85%E5%AD%A6%E4%B9%A0-iOS14%E9%9A%90%E7%A7%81%E9%80%82%E9%85%8D%E5%8F%8A%E9%83%A8%E5%88%86%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V){return {data:[{},{article:{slug:C,draft:true,date:D,title:E,toc:[{id:u,depth:m,text:u},{id:v,depth:m,text:v},{id:F,depth:m,text:G},{id:H,depth:m,text:I},{id:w,depth:m,text:w},{id:x,depth:m,text:x},{id:J,depth:m,text:K},{id:L,depth:m,text:M}],body:{type:"root",children:[{type:b,tag:d,props:{},children:[{type:a,value:"\u003E 本文由 [简悦 SimpRead]("},{type:b,tag:g,props:{href:N,rel:[y,z,A],target:B},children:[{type:a,value:N}]},{type:a,value:") 转码， 原文地址 [juejin.im]("},{type:b,tag:g,props:{href:O,rel:[y,z,A],target:B},children:[{type:a,value:O}]},{type:a,value:")"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356cd3c10e1476?imageslim"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"作者 | 盛兰雅（岚遥）"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"编辑 | 橙子君"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"出品 | 阿里巴巴新零售淘系技术"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"在刚刚结束的线上 WWDC 2020 发布会上苹果向我们展示了新的 iOS14 系统。iOS14 的适配，很重要的一环就集中在用户隐私和安全方面。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"在 iOS13 及以前，当用户首次访问应用程序时，会被要求开放大量权限，比如相册、定位、联系人，实际上该应用可能仅仅需要一个选择图片功能，却被要求开放整个照片库的权限，这确实是不合理的。对于相册，在 iOS14 中引入了 “LimitedPhotos Library” 的概念，用户可以授予应用访问其一部分的照片，对于应用来说，仅能读取到用户选择让应用来读取的照片，让我们看到了 Apple 对于用户隐私的尊重。这仅仅是一部分，在 iOS14 中，可以看到诸多类似的保护用户隐私的措施，也需要我们升级适配。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"最近在调研 iOS14 的适配方案，本文主要分享一下 iOS14 上对于隐私授权的变更和部分适配方案，欢迎补充指正。"}]},{type:a,value:c},{type:b,tag:P,props:{id:Q},children:[{type:b,tag:g,props:{href:"#%E9%80%82%E9%85%8D%E7%82%B9",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:Q}]},{type:a,value:c},{type:b,tag:n,props:{id:u},children:[{type:b,tag:g,props:{href:"#%E7%9B%B8%E5%86%8C",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:u}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"iOS14 新增了 “Limited Photo Library Access” 模式，在授权弹窗中增加了 Select Photo 选项。用户可以在 App 请求调用相册时选择部分照片让 App 读取。从 App 的视⻆来看，你的相册里就只有这几张照片，App 无法得知其它照片的存在。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356ce165ef7540?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"iOS14 中当用户选择 “PHAuthorizationStatusLimited” 时，如果未进行适配，有可能会在每次触发相册功能时都进行弹窗询问用户是否需要修改照片权限。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"对于这种情况可通过在 Info.plist 中设置 “PHPhotoLibraryPreventAutomaticLimitedAccessAlert” 的值为 YES 来阻止该弹窗反复弹出，并且可通过下面这个 API 来主动控制何时弹出 PHPickerViewController 进行照片选择。"}]},{type:a,value:c},{type:b,tag:o,props:{className:[p]},children:[{type:b,tag:q,props:{className:[r,s]},children:[{type:b,tag:t,props:{},children:[{type:a,value:"\\[\\[PHPhotoLibrary sharedPhotoLibrary\\] presentLimitedLibraryPickerFromViewController:self\\];\n复制代码\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"在 iOS14 中官方推荐使用 PHPicker 来替代原 API 进行图片选择。PHPicker 为独立进程，会在视图最顶层进行展示，应用内无法对其进行截图也无法直接访问到其内的数据。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"1、UIImagePickerController -\u003E PHPickerViewController， UIImagePickerViewController 功能受限，每次只能选择一张图片，将逐渐被废弃。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356cff4c9d5390?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"2、PHPicker 支持多选，支持搜索，支持按 image，video，livePhotos 等进行选择。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d013ede64d4?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"新 API 及迁移 demo:"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d05726cf08f?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:o,props:{className:[p]},children:[{type:b,tag:q,props:{className:[r,s]},children:[{type:b,tag:t,props:{},children:[{type:a,value:"@interface ViewController () \u003CPHPickerViewControllerDelegate\u003E\n  \n  @property (weak, nonatomic) IBOutlet UIImageView \\*imageView;\n@property (nonatomic, strong) NSArray\u003CNSItemProvider \\*\u003E \\*itemProviders;\n  \n@end\n  \n@implementation ViewController\n  \n  - (void)viewDidLoad {\n      \\[super viewDidLoad\\];\n      \u002F\u002F Do any additional setup after loading the view.\n}\n  \n  - (IBAction)button:(id)sender {\n      \u002F\u002F 以下 API 仅为 iOS14 only\n      PHPickerConfiguration \\*configuration = \\[\\[PHPickerConfiguration alloc\\] init\\];\n      configuration.filter = \\[PHPickerFilter videosFilter\\]; \u002F\u002F 可配置查询用户相册中文件的类型，支持三种\n    configuration.selectionLimit = 0; \u002F\u002F 默认为1，为0时表示可多选。\n  \n      PHPickerViewController \\*picker = \\[\\[PHPickerViewController alloc\\] initWithConfiguration:configuration\\];\n      picker.delegate = self;\n      \u002F\u002F picker vc，在选完图片后需要在回调中手动 dismiss\n    \\[self presentViewController:picker animated:YES completion:^{\n  \n      }\\];\n  }\n  \n#pragma mark - Delegate\n  \n  - (void)picker:(PHPickerViewController \\*)picker didFinishPicking:(NSArray\u003CPHPickerResult \\*\u003E \\*)results {\n      \\[picker dismissViewControllerAnimated:YES completion:nil\\];\n      if (!results || !results.count) {\n          return;\n      }\n      NSItemProvider \\*itemProvider = results.firstObject.itemProvider;\n      if (\\[itemProvider canLoadObjectOfClass:UIImage.class\\]) {\n          \\_\\_weak typeof(self) weakSelf = self;\n          \\[itemProvider loadObjectOfClass:UIImage.class completionHandler:^(\\_\\_kindof id\u003CNSItemProviderReading\u003E  \\_Nullable object, NSError \\* \\_Nullable error) {\n              if (\\[object isKindOfClass:UIImage.class\\]) {\n                  \\_\\_strong typeof(self) strongSelf = weakSelf;\n                  dispatch\\_async(dispatch\\_get\\_main\\_queue(), ^{\n                      strongSelf.imageView.image = (UIImage \\*)object;\n                  });\n              }\n          }\\]; \n      }\n    }\n复制代码\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"需要注意的是，在 limit Photo 模式下，AssetsLibrary 访问相册会失败；在 writeOnly 模式下，AssetLibrary 也会有显示问题。建议还在使用 AssetsLibrary 的同学尽快迁移到新 API。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"授权相关：旧 API 废弃，增加 PHAccessLevel 参数。如果再使用以前的 API 来获取权限状态， PHAuthorizationStatusLimited 状态下也会返回 PHAuthorizationStatusAuthorized"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d1c6a0acf7d?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:o,props:{className:[p]},children:[{type:b,tag:q,props:{className:[r,s]},children:[{type:b,tag:t,props:{},children:[{type:a,value:"typedef NS\\_ENUM(NSInteger, PHAccessLevel) {\n  PHAccessLevelAddOnly = 1, \u002F\u002F 仅允许添加照片\n  PHAccessLevelReadWrite = 2, \u002F\u002F 允许访问照片，limitedLevel 必须为 readWrite\n} API\\_AVAILABLE(macos(10.16), ios(14), tvos(14));\n\n\u002F\u002F 查询权限\nPHAccessLevel level = PHAccessLevelReadWrite;\nPHAuthorizationStatus status = \\[PHPhotoLibrary authorizationStatusForAccessLevel:level\\];\n  switch (status) {\n      case PHAuthorizationStatusLimited:\n          NSLog(@\"limited\");\n          break;\n      case PHAuthorizationStatusDenied:\n          NSLog(@\"denied\");\n          break;\n      case PHAuthorizationStatusAuthorized:\n          NSLog(@\"authorized\");\n          break;\n      default:\n          break;\n}\n\n\u002F\u002F 请求权限，需注意 limited 权限尽在 accessLevel 为 readAndWrite 时生效\n\\[PHPhotoLibrary requestAuthorizationForAccessLevel:level handler:^(PHAuthorizationStatus status) {\n  switch (status) {\n      case PHAuthorizationStatusLimited:\n          NSLog(@\"limited\");\n          break;\n      case PHAuthorizationStatusDenied:\n          NSLog(@\"denied\");\n          break;\n      case PHAuthorizationStatusAuthorized:\n          NSLog(@\"authorized\");\n          break;\n      default:\n          break; \n  }\n}\\];\n复制代码\n"}]}]}]},{type:a,value:c},{type:b,tag:n,props:{id:v},children:[{type:b,tag:g,props:{href:"#%E5%AE%9A%E4%BD%8D",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:v}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"在 iOS13 及以前，App 请求用户定位授权时为如下形态：一旦用户同意应用获取定位信息，当前应用就可以获取到用户的精确定位。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d22ac1aeab5?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"iOS14 新增用户大致位置选项可供用户选择，原因是大多数 App 实际上并不需要获取用户到用户最准确的定位信息。iOS14 授权弹窗新增的 Precise 的开关默认会选中精确位置。用户通过这个开关可以进行更改，当把这个值设为 On 时，地图上会显示精确位置；切换为 Off 时，将显示用户的大致位置。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"对于对用户位置敏感度不高的 App 来说，这个似乎无影响，但是对于强依赖精确位置的 App 适配工作就显得非常重要了。可以通过用户在 “隐私设置” 中设置来开启精确定位，但是可能用户宁可放弃使用这个应用也不愿意开启。这个时候，iOS14 在 CLLocationManager 新增两个方法可用于向用户申请临时开启一次精确位置权限。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d28b413c4f9?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"使用方式也很简单，需要首先在 Info.plist 中配置 “NSLocationTemporaryUsageDescriptionDictionary” 字典中需要配置 key 和 value 表明使用位置的原因，以及具体的描述。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d2bc23b10b0?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"在本例中，key 即为获取用户权限时传的 \"purposeKey\"，最终呈现给用户的就是左图，右图为当 App 主动关闭精确定位权限申请。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d2d7af0eb42?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"对于地理位置不敏感的 App 来说，iOS14 也可以通过直接在 info.plist 中添加 NSLocationDefaultAccuracyReduced 为 true 默认请求大概位置。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d313fbccfc2?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"这样设置之后，即使用户想要为该 App 开启精确定位权限，也无法开启。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"也可以直接通过 API 来根据不同的需求设置不同的定位精确度。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d34b53ab509?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"需要注意的是，当 App 在 Background 模式下，如果并未获得精确位置授权，那么 Beacon 及其他位置敏感功能都将受到限制。"}]},{type:a,value:c},{type:b,tag:n,props:{id:F},children:[{type:b,tag:g,props:{href:"#local-network",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:G}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"iOS14 当 App 要使用 Bonjour 服务时或者访问本地局域网，使用 mDNS 服务等，都需要授权，开发者需要在 Info.plist 中详细描述使用的为哪种服务以及用途。下图为需要无需申请权限与需要授权的服务："}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d3a7ea7a3e0?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"在 \"隐私设置\" 中也可以查看和修改具体有哪些 App 正在使用 LocalNetwork"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d3d588d7a0c?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"如果应用中需要使用 LocalNetwork 需要在 Info.plist 中配置两个选项，详细描述为什么需要使用该权限，以及需要列出具体使用 LocalNetwork 的服务列表。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d41b03f7502?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"对于使用了下列包含 Bonjour 的 framework，都需要更新描述."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d43ba16ca02?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:n,props:{id:H},children:[{type:b,tag:g,props:{href:"#wi-fi-address",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:I}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"iOS8 - iOS13 ，用户在不同的网络间切换和接入时，mac 地址都不会改变，这也就使得网络运营商还是可以通过 mac 地址对用户进行匹配和用户信息收集，生成完整的用户信息。iOS14 提供 Wifi 加密服务，每次接入不同的 WiFi 使用的 mac 地址都不同。每过 24 小时，mac 地址还会更新一次。需要关注是否有使用用户网络 mac 地址的服务。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"下图为 iOS13 及之前用户接入网络时 mac 地址并不会进行改变"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d4735f45fd5?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"下图为 iOS14 用户接入 Wi-Fi 时 mac 地址的变化情况"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d49b5cf4402?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"并且用户也可以自行选择是否开启 private Wi-Fi address"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d4bd97f2a72?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:n,props:{id:w},children:[{type:b,tag:g,props:{href:"#%E5%89%AA%E5%88%87%E6%9D%BF",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:w}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"在 iOS14 中，读取用户剪切板的数据会弹出提示。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d4f736f8ec6?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"弹出提示的原因是使用 UIPasteboard 访问用户数据，访问以下数据都会弹出 toast 提示。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d5293081a84?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"兼容方案：如果应用访问剪切板仅仅用于判断是否为 URL 格式，则 iOS14 新增了两个 API 可以用于规避该提示。如果应用想直接访问剪切板的数据，暂时可能无法做到规避该提示。iOS14 新增两种 UIPasteboardDetectionPattern。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d56631321a5?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"上面的两个 API 可用于规避提示，但只能用于判断剪切板中是否有 URL，并不是真正的访问剪贴板数据，也拿不到剪切板的真实数据。下面两个 API 可以获得具体的 URL 信息，但是会触发剪切板提示。并且实测当用户剪切板中包含多个 URL 时只会返回第一个。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17356d586de2a3a6?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"使用示例"}]},{type:a,value:c},{type:b,tag:o,props:{className:[p]},children:[{type:b,tag:q,props:{className:[r,s]},children:[{type:b,tag:t,props:{},children:[{type:a,value:"NSSet \\*patterns = \\[\\[NSSet alloc\\] initWithObjects:UIPasteboardDetectionPatternProbableWebURL, nil\\];\n\\[\\[UIPasteboard generalPasteboard\\] detectPatternsForPatterns:patterns completionHandler:^(NSSet\u003CUIPasteboardDetectionPattern\u003E \\* \\_Nullable result, NSError \\* \\_Nullable error) {\n    if (result && result.count) {\n            \u002F\u002F 当前剪切板中存在 URL\n    }\n}\\];\n复制代码\n"}]}]}]},{type:a,value:c},{type:b,tag:n,props:{id:x},children:[{type:b,tag:g,props:{href:"#%E7%9B%B8%E6%9C%BA%E5%92%8C%E9%BA%A6%E5%85%8B%E9%A3%8E",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:x}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"iOS14 中 App 使用相机和麦克风时会有图标提示以及绿点和黄点提示，并且会显示当前是哪个 App 在使用此功能。我们无法控制是否显示该提示。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"会触发录音小黄点的代码示例："}]},{type:a,value:c},{type:b,tag:o,props:{className:[p]},children:[{type:b,tag:q,props:{className:[r,s]},children:[{type:b,tag:t,props:{},children:[{type:a,value:"AVAudioRecorder \\*recorder = \\[\\[AVAudioRecorder alloc\\] initWithURL:recorderPath settings:nil error:nil\\];\n\\[recorder record\\];\n复制代码\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"触发相机小绿点的代码示例:"}]},{type:a,value:c},{type:b,tag:o,props:{className:[p]},children:[{type:b,tag:q,props:{className:[r,s]},children:[{type:b,tag:t,props:{},children:[{type:a,value:"AVCaptureDeviceInput \\*videoInput = \\[\\[AVCaptureDeviceInput alloc\\] initWithDevice:videoCaptureDevice error:nil\\];\nAVCaptureSession \\*session = \\[\\[AVCaptureSession alloc\\] init\\];\nif (\\[session canAddInput:videoInput\\]) {\n    \\[session addInput:videoInput\\];\n}\n\\[session startRunning\\];\n复制代码\n"}]}]}]},{type:a,value:c},{type:b,tag:n,props:{id:J},children:[{type:b,tag:g,props:{href:"#idfa",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:K}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"IDFA 全称为 Identity for Advertisers ，即广告标识符。用来标记用户，目前最广泛的用途是用于投放广告、个性化推荐等。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"在 iOS13 及以前，系统会默认为用户开启允许追踪设置，我们可以简单的通过代码来获取到用户的 IDFA 标识符。"}]},{type:a,value:c},{type:b,tag:o,props:{className:[p]},children:[{type:b,tag:q,props:{className:[r,s]},children:[{type:b,tag:t,props:{},children:[{type:a,value:"if (\\[\\[ASIdentifierManager sharedManager\\] isAdvertisingTrackingEnabled\\]) {\n    NSString \\*idfaString = \\[\\[ASIdentifierManager sharedManager\\] advertisingIdentifier\\].UUIDString;\n    NSLog(@\"%@\", idfaString);\n}\n复制代码\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"但是在 iOS14 中，这个判断用户是否允许被追踪的方法已经废弃。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F1735723d46067ae5?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"iOS14 中，系统会默认为用户关闭广告追踪权限。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F1735723f3bb1cf4a?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"✎ 对于这种情况，我们需要去请求用户权限。首先需要在 Info.plist 中配置 \"NSUserTrackingUsageDescription\" 及描述文案，接着使用 AppTrackingTransparency 框架中的 ATTrackingManager 中的 requestTrackingAuthorizationWithCompletionHandler 请求用户权限，在用户授权后再去访问 IDFA 才能够获取到正确信息。"}]},{type:a,value:c},{type:b,tag:o,props:{className:[p]},children:[{type:b,tag:q,props:{className:[r,s]},children:[{type:b,tag:t,props:{},children:[{type:a,value:"#import \u003CAppTrackingTransparency\u002FAppTrackingTransparency.h\u003E\n#import \u003CAdSupport\u002FAdSupport.h\u003E\n\n- (void)testIDFA {\n    if (@available(iOS 14, \\*)) {\n        \\[ATTrackingManager requestTrackingAuthorizationWithCompletionHandler:^(ATTrackingManagerAuthorizationStatus status) {\n            if (status == ATTrackingManagerAuthorizationStatusAuthorized) {\n                NSString \\*idfaString = \\[\\[ASIdentifierManager sharedManager\\] advertisingIdentifier\\].UUIDString;\n            }\n        }\\];\n    } else {\n        \u002F\u002F 使用原方式访问 IDFA\n    }\n}\n复制代码\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"对于用户拒绝授权 UserTracking 的情况，可以考虑接入苹果的 SKAdNetwork 框架进行广告分析。感兴趣的同学可进一步了解："},{type:b,tag:g,props:{href:"https:\u002F\u002Fdeveloper.apple.com\u002Fdocumentation\u002Fstorekit\u002Fskadnetwork",rel:[y,z,A],target:B},children:[{type:a,value:"developer.apple.com\u002Fdocumentati…"}]}]},{type:a,value:c},{type:b,tag:n,props:{id:L},children:[{type:b,tag:g,props:{href:"#%E4%B8%8A%E4%BC%A0-appstore",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:M}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"更加严格的隐私审核，可以让用户在下载 App 之前就知道此 App 将会需要哪些权限。目前苹果商店要求所有应用在上架时都必须提供一份隐私政策。如果引入了第三方收集用户信息等 SDK，都需要向苹果说明是这些信息的用途。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F173572453d837b25?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F17357246cc54db4f?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]},{type:a,value:c},{type:b,tag:P,props:{id:R},children:[{type:b,tag:g,props:{href:"#%E6%80%BB%E7%BB%93",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:R}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"对于这次 iOS14 的隐私权限大升级和新尝试，体现了苹果对于用户隐私的尊重。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"从用户角度来说，近年来越来越精准的广告投放让我们越来越感觉自己被” 监视 “着，此次升级后，我们有了更多保护自己隐私的方式以及避免广告骚扰的方法，苹果此举无疑会加大我们对其的好感度和信任感。但从另一个角度来说，对于 IDFA 的限制，可能会导致之前许多依靠广告投放收入的免费 App 难以继续维持生计，也可能也会导致免费 App 的数量有所降低。从开发者的角度来说，除了对 iOS14 隐私升级的积极适配外，也让我们感受到了 iOS14 中对于用户隐私的重视无疑会提高获取用户行为信息的成本。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"冲击最大的应该就是广告行业，对于目前的推荐算法和用户拉新都会受到影响，如何在充分尊重用户隐私的前提下进行广告的精准投放对于开发者和广告商来说都是一个不小的机遇和挑战。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"下一期，我们聊聊 【Metal 新特性详解 | 带来的技术启发和思考】，敬请持续关注~"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:S,props:{},children:[{type:a,value:"参考资料"}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"WWDC 2020 Apple Developer"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Developer Documentation"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:S,props:{},children:[{type:a,value:"手淘客户端—小程序与跨平台技术部"}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"我们是支撑小程序、小游戏、Flutter 等跨平台技术的核心团队，有技术广度和也有技术深度，我们需要 iOS、Android、C++、Flutter、Canvas、游戏引擎、WebGL 等各方面的人才。如果你善于学习，这是一个很好的接触跨领域知识的机会。"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"如果你是个对技术有追求对小伙伴，请别犹豫，立刻联系我！ 📮："},{type:b,tag:g,props:{href:"mailto:lanya.sly@alibaba-inc.com"},children:[{type:a,value:"lanya.sly@alibaba-inc.com"}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:e,props:{alt:f,src:"https:\u002F\u002Fuser-gold-cdn.xitu.io\u002F2020\u002F7\u002F16\u002F1735725013d1f8f3?imageView2\u002F0\u002Fw\u002F1280\u002Fh\u002F960\u002Fformat\u002Fwebp\u002Fignore-error\u002F1"},children:[]}]}]},dir:"\u002Fwiki\u002F0\u002F待学习",path:T,extension:".md",createdAt:U,updatedAt:U},prev:{slug:"UICollectionView-UICollectionView自适应高度",date:"2020-10-23T05:31:37.000Z",title:"UICollectionView自适应高度(autolayout)"},next:{slug:"适配-viewport适配布局",date:"2020-10-26T06:51:25.000Z",title:"Viewport适配布局(转载)"},scrollTop:V,sideCategory:[{folderName:"0",articles:[{slug:"0-z",date:"2020-11-11T09:59:03.000Z",title:"待补充",path:"\u002Fwiki\u002F0\u002F0-z"},{slug:"0-搞懂git",date:"2020-11-13T03:14:51.000Z",title:"一文搞懂git",path:"\u002Fwiki\u002F0\u002F0-搞懂git"}],children:[{folderName:"待学习",articles:[{slug:"待学习-HBDNavigationBar",date:"2020-10-23T08:26:24.000Z",title:"HBDNavigationBar",path:"\u002Fwiki\u002F0\u002F待学习\u002F待学习-HBDNavigationBar"},{slug:"待学习-PromisKit",date:"2020-10-23T08:42:16.000Z",title:"PromisKit",path:"\u002Fwiki\u002F0\u002F待学习\u002F待学习-PromisKit"},{slug:"待学习-apns指南",date:"2020-10-26T05:47:15.000Z",title:"Apns指南",path:"\u002Fwiki\u002F0\u002F待学习\u002F待学习-apns指南"},{slug:"待学习-rumtime源码解读",date:"2020-11-18T08:42:16.000Z",title:"rumtime源码解读",path:"\u002Fwiki\u002F0\u002F待学习\u002F待学习-rumtime源码解读"},{slug:"待学习-then",date:"2020-10-23T08:42:25.000Z",title:"Then",path:"\u002Fwiki\u002F0\u002F待学习\u002F待学习-then"},{slug:C,date:D,title:E,path:T}],children:[]},{folderName:"书单",articles:[{slug:"书单-参考书单",date:"2020-11-11T09:53:19.000Z",title:"(转载)书单",path:"\u002Fwiki\u002F0\u002F书单\u002F书单-参考书单"}],children:[]}]}]}],fetch:{},mutations:V}}("text","element","\n","p","img","","a","true",-1,"span","icon","icon-link",2,"h2","div","nuxt-content-highlight","pre","language-text","line-numbers","code","相册","定位","剪切板","相机和麦克风","nofollow","noopener","noreferrer","_blank","待学习-iOS14隐私适配及部分解决方案","2020-10-23T09:09:09.000Z","iOS14隐私适配及部分解决方案","local-network","Local Network","wi-fi-address","Wi-Fi Address","idfa","IDFA","上传-appstore","上传 AppStore","http:\u002F\u002Fksria.com\u002Fsimpread\u002F","https:\u002F\u002Fjuejin.im\u002Fpost\u002F6850418120923250701#heading-5","h1","适配点","总结","strong","\u002Fwiki\u002F0\u002F待学习\u002F待学习-iOS14隐私适配及部分解决方案","2021-09-08T14:11:30.308Z",void 0)));